<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Seva Application</title>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, onSnapshot, orderBy, updateDoc, doc, where, limit, deleteDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-storage.js";

        // ** IMPORTANT: Replace with your actual Firebase configuration! **
   // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyAE9QcgKPFGT7ahVpJb7QCkT7VZ5hCp80U",
  authDomain: "my-chat-app-9b8e3.firebaseapp.com",
  databaseURL: "https://my-chat-app-9b8e3-default-rtdb.firebaseio.com",
  projectId: "my-chat-app-9b8e3",
  storageBucket: "my-chat-app-9b8e3.firebasestorage.app",
  messagingSenderId: "1032323686645",
  appId: "1:1032323686645:web:79d7b712b8d3e338ac65bc",
  measurementId: "G-F148SDPL2P"
};

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // --- Admin User List (For Admin Delete Feature) ---
        const adminUsers = ['Team 1 CO']; // Add admin usernames here

        // --- Function to check if sender is admin ---
        function isAdminUser(senderName) {
            return adminUsers.includes(senderName);
        }

        // --- State and District Data ---
        const stateDistricts = {
            "Andhra Pradesh": ["Anantapur", "Chittoor", "East Godavari", "Guntur", "Krishna", "Kurnool", "Nellore", "Prakasam", "Srikakulam", "Visakhapatnam", "Vizianagaram", "West Godavari", "YSR Kadapa"],
            "Arunachal Pradesh": ["Tawang", "West Kameng", "East Kameng", "Papum Pare", "Kurung Kumey", "Kra Daadi", "Lower Subansiri", "Upper Subansiri", "West Siang", "East Siang", "Siang", "Upper Siang", "Lower Siang", "Lohit", "Anjaw", "Dibang Valley", "Upper Dibang Valley", "Changlang", "Tirap", "Longding", "Namsai", "Shi Yomi", "Pakke-Kessang", "Lepa-Rada"],
            "Assam": ["Baksa", "Barpeta", "Biswanath", "Bongaigaon", "Cachar", "Charaideo", "Chirang", "Darrang", "Dhemaji", "Dhubri", "Dibrugarh", "Dima Hasao", "Goalpara", "Golaghat", "Hailakandi", "Hojai", "Jorhat", "Kamrup Metropolitan", "Kamrup Rural", "Karbi Anglong", "Karimganj", "Kokrajhar", "Lakhimpur", "Majuli", "Morigaon", "Nagaon", "Nalbari", "Sivasagar", "Sonitpur", "South Salmara-Mankachar", "Tinsukia", "Udalguri", "West Karbi Anglong"],
            "Bihar": ["Araria", "Arwal", "Aurangabad", "Banka", "Begusarai", "Bhagalpur", "Bhojpur", "Buxar", "Darbhanga", "East Champaran", "Gaya", "Gopalganj", "Jamui", "Jehanabad", "Kaimur", "Katihar", "Khagaria", "Kishanganj", "Lakhisarai", "Madhepura", "Madhubani", "Munger", "Muzaffarpur", "Nalanda", "Nawada", "Patna", "Purnia", "Rohtas", "Saharsa", "Samastipur", "Saran", "Sheikhpura", "Sheohar", "Sitamarhi", "Siwan", "Supaul", "Vaishali", "West Champaran"],
            "Chhattisgarh": ["Raipur", "Bilaspur", "Durg", "Rajnandgaon", "Korba", "Raigarh", "Janjgir-Champa", "Mahasamund", "Kawardha", "Bastar", "Dantewada", "Kanker", "Jashpur", "Surguja", "Baloda Bazar", "Gariaband", "Balrampur", "Bijapur", "Narayanpur", "Sukma", "Kondagaon", "Mungeli", "Bemetara", "Surajpur", "Gaurela-Pendra-Marwahi", "Sakti", "Manendragarh-Chirmiri-Bharatpur", "Khairagarh-Chhuikhadan-Gandai", "Mohla-Manpur-Ambagarh Chowki", "Sarangarh-Bilaigarh"],
            "Goa": ["North Goa", "South Goa"],
            "Gujarat": ["Ahmedabad", "Amreli", "Anand", "Aravalli", "Banaskantha", "Bharuch", "Bhavnagar", "Botad", "Chhota Udaipur", "Dahod", "Dang", "Devbhoomi Dwarka", "Gandhinagar", "Gir Somnath", "Jamnagar", "Junagadh", "Kheda", "Kutch", "Mahisagar", "Mehsana", "Morbi", "Narmada", "Navsari", "Panchmahal", "Patan", "Porbandar", "Rajkot", "Sabarkantha", "Surat", "Surendranagar", "Tapi", "Vadodara", "Valsad"],
            "Haryana": ["Ambala", "Bhiwani", "Charkhi Dadri", "Faridabad", "Fatehabad", "Gurugram", "Hisar", "Jhajjar", "Jind", "Kaithal", "Karnal", "Kurukshetra", "Mahendragarh", "Mewat", "Palwal", "Panchkula", "Panipat", "Rewari", "Rohtak", "Sirsa", "Sonipat", "Yamunanagar"],
            "Himachal Pradesh": ["Bilaspur", "Chamba", "Hamirpur", "Kangra", "Kinnaur", "Kullu", "Lahaul and Spiti", "Mandi", "Shimla", "Sirmaur", "Solan", "Una"],
            "Jharkhand": ["Bokaro", "Chatra", "Deoghar", "Dhanbad", "Dumka", "East Singhbhum", "Garhwa", "Giridih", "Godda", "Gumla", "Hazaribagh", "Jamtara", "Khunti", "Koderma", "Latehar", "Lohardaga", "Pakur", "Palamu", "Ramgarh", "Ranchi", "Saraikela-Kharsawan", "Sahebganj", "Simdega", "West Singhbhum"],
            "Karnataka": ["Bagalkot", "Ballari (Bellary)", "Belagavi (Belgaum)", "Bengaluru Rural", "Bengaluru Urban", "Bidar", "Chamarajanagar", "Chikballapur", "Chikkamagaluru", "Chitradurga", "Dakshina Kannada", "Davanagere", "Dharwad", "Gadag", "Hassan", "Haveri", "Kalaburagi (Gulbarga)", "Kodagu", "Kolar", "Koppal", "Mandya", "Mysuru (Mysore)", "Raichur", "Ramanagara", "Shivamogga (Shimoga)", "Tumakuru (Tumkur)", "Udupi", "Uttara Kannada (Karwar)", "Vijayapura (Bijapur)", "Yadgir"],
            "Kerala": ["Alappuzha", "Ernakulam", "Idukki", "Kannur", "Kasaragod", "Kollam", "Kottayam", "Kozhikode", "Malappuram", "Palakkad", "Pathanamthitta", "Thiruvananthapuram", "Thrissur", "Wayanad"],
            "Madhya Pradesh": ["Agar Malwa", "Alirajpur", "Anuppur", "Ashoknagar", "Balaghat", "Barwani", "Betul", "Bhind", "Bhopal", "Burhanpur", "Chhatarpur", "Chhindwara", "Damoh", "Datia", "Dewas", "Dhar", "Dindori", "Guna", "Gwalior", "Harda", "Hoshangabad", "Indore", "Jabalpur", "Jhabua", "Katni", "Khandwa", "Khargone", "Mandla", "Mandsaur", "Morena", "Narsinghpur", "Neemuch", "Panna", "Raisen", "Rajgarh", "Ratlam", "Rewa", "Sagar", "Satna", "Sehore", "Seoni", "Shahdol", "Shajapur", "Sheopur", "Shivpuri", "Sidhi", "Singrauli", "Tikamgarh", "Ujjain", "Umaria", "Vidisha"],
            "Maharashtra": ["Mumbai City", "Mumbai Suburban", "Pune", "Nagpur", "Nashik", "Aurangabad", "Solapur", "Kolhapur", "Amravati", "Akola", "Latur", "Sangli", "Satara", "Ahmednagar", "Jalgaon", "Dhule", "Nandurbar", "Buldhana", "Yavatmal", "Wardha", "Chandrapur", "Gadchiroli", "Hingoli", "Jalna", "Osmanabad", "Parbhani", "Raigad", "Ratnagiri", "Sindhudurg", "Thane"],
            "Manipur": ["Bishnupur", "Chandel", "Churachandpur", "Imphal East", "Imphal West", "Jiribam", "Kakching", "Kamjong", "Kangpokpi", "Noney", "Pherzawl", "Senapati", "Tamenglong", "Tengnoupal", "Thoubal", "Ukhrul"],
            "Meghalaya": ["East Garo Hills", "East Jaintia Hills", "East Khasi Hills", "North Garo Hills", "Ri Bhoi", "South Garo Hills", "South West Garo Hills", "South West Khasi Hills", "West Garo Hills", "West Jaintia Hills", "West Khasi Hills"],
            "Mizoram": ["Aizawl", "Champhai", "Hnahthial", "Khawzawl", "Kolasib", "Lawngtlai", "Lunglei", "Mamit", "Saiha", "Saitual", "Serchhip"],
            "Nagaland": ["Dimapur", "Kiphire", "Kohima", "Longleng", "Mokokchung", "Mon", "Peren", "Phek", "Tuensang", "Wokha", "Zunheboto", "Noklak", "Shamator", "Tseminyu"],
            "Odisha": ["Angul", "Balangir", "Baleswar", "Bargarh", "Bhadrak", "Boudh", "Cuttack", "Deogarh", "Dhenkanal", "Gajapati", "Ganjam", "Jagatsinghpur", "Jajpur", "Jharsuguda", "Kalahandi", "Kandhamal", "Kendrapara", "Kendujhar (Keonjhar)", "Khordha", "Koraput", "Malkangiri", "Mayurbhanj", "Nabarangpur", "Nayagarh", "Nuapada", "Puri", "Rayagada", "Sambalpur", "Subarnapur (Sonepur)", "Sundargarh"],
            "Punjab": ["Amritsar", "Barnala", "Bathinda", "Faridkot", "Fatehgarh Sahib", "Fazilka", "Ferozepur", "Gurdaspur", "Hoshiarpur", "Jalandhar", "Kapurthala", "Ludhiana", "Mansa", "Moga", "Muktsar", "Nawanshahr", "Pathankot", "Patiala", "Rupnagar", "Sangrur", "SAS Nagar", "Tarn Taran"],
            "Rajasthan": ["Ajmer", "Alwar", "Banswara", "Baran", "Barmer", "Bharatpur", "Bhilwara", "Bikaner", "Bundi", "Chittorgarh", "Churu", "Dausa", "Dholpur", "Dungarpur", "Hanumangarh", "Jaipur", "Jaisalmer", "Jalore", "Jhalawar", "Jhunjhunu", "Jodhpur", "Karauli", "Kota", "Nagaur", "Pali", "Pratapgarh", "Rajsamand", "Sawai Madhopur", "Sikar", "Sirohi", "Sri Ganganagar", "Tonk", "Udaipur"],
            "Sikkim": ["East Sikkim", "North Sikkim", "South Sikkim", "West Sikkim"],
            "Tamil Nadu": ["Ariyalur", "Chennai", "Coimbatore", "Cuddalore", "Dharmapuri", "Dindigul", "Erode", "Kallakurichi", "Kanchipuram", "Kanyakumari", "Karur", "Krishnagiri", "Madurai", "Nagapattinam", "Namakkal", "Nilgiris", "Perambalur", "Pudukkottai", "Ramanathapuram", "Ranipet", "Salem", "Sivaganga", "Tenkasi", "Thanjavur", "Theni", "Thoothukudi (Tuticorin)", "Tiruchirappalli", "Tirunelveli", "Tirupathur", "Tiruppur", "Tiruvallur", "Tiruvannamalai", "Tiruvarur", "Vellore", "Viluppuram", "Virudhunagar"],
            "Telangana": ["Adilabad", "Bhadradri Kothagudem", "Hyderabad", "Jagitial", "Jangaon", "Jayashankar Bhupalpally", "Jogulamba Gadwal", "Kamareddy", "Karimnagar", "Khammam", "Komaram Bheem Asifabad", "Mahabubabad", "Mahbubnagar", "Mancherial", "Medak", "Medchal–Malkajgiri", "Mulugu", "Nagarkurnool", "Nalgonda", "Narayanpet", "Nirmal", "Nizamabad", "Peddapalli", "Rajanna Sircilla", "Ranga Reddy", "Sangareddy", "Siddipet", "Suryapet", "Vikarabad", "Wanaparthy", "Warangal Rural", "Warangal Urban", "Yadadri Bhuvanagiri"],
            "Tripura": ["Dhalai", "Gomati", "Khowai", "North Tripura", "Sepahijala", "South Tripura", "Unakoti", "West Tripura"],
            "Uttar Pradesh": ["Agra", "Aligarh", "Ambedkar Nagar", "Amethi", "Amroha", "Auraiya", "Ayodhya", "Azamgarh", "Baghpat", "Bahraich", "Ballia", "Balrampur", "Banda", "Barabanki", "Bareilly", "Basti", "Bhadohi", "Bijnor", "Budaun", "Bulandshahr", "Chandauli", "Chitrakoot", "Deoria", "Etah", "Etawah", "Farrukhabad", "Fatehpur", "Firozabad", "Gautam Buddha Nagar", "Ghaziabad", "Ghazipur", "Gonda", "Gorakhpur", "Hamirpur", "Hapur", "Hardoi", "Hathras", "Jalaun", "Jaunpur", "Kannauj", "Kanpur Dehat", "Kanpur Nagar", "Kasganj", "Kaushambi", "Kheri", "Kushinagar", "Lalitpur", "Lucknow", "Maharajganj", "Mahoba", "Mainpuri", "Mathura", "Mau", "Meerut", "Mirzapur", "Moradabad", "Muzaffarnagar", "Pilibhit", "Pratapgarh", "Prayagraj", "Raebareli", "Rampur", "Saharanpur", "Sambhal", "Sant Kabir Nagar", "Shahjahanpur", "Shamli", "Shravasti", "Siddharthnagar", "Sitapur", "Sonbhadra", "Sultanpur", "Unnao", "Varanasi"],
            "Uttarakhand": ["Almora", "Bageshwar", "Chamoli", "Champawat", "Dehradun", "Haridwar", "Nainital", "Pauri Garhwal", "Pithoragarh", "Rudraprayag", "Tehri Garhwal", "Udham Singh Nagar", "Uttarkashi"],
            "West Bengal": ["Alipurduar", "Bankura", "Birbhum", "Cooch Behar", "Dakshin Dinajpur", "Darjeeling", "Hooghly", "Howrah", "Jalpaiguri", "Jhargram", "Kalimpong", "Kolkata", "Malda", "Murshidabad", "Nadia", "North 24 Parganas", "Paschim Bardhaman", "Paschim Medinipur", "Purba Bardhaman", "Purba Medinipur", "Purulia", "South 24 Parganas", "Uttar Dinajpur"]
            // Add more states and districts as needed
        };


        function populateDistricts() {
            const stateDropdown = document.getElementById('state');
            const districtDropdown = document.getElementById('district');
            const selectedState = stateDropdown.value;

            districtDropdown.innerHTML = '<option value="">Select District</option>'; // Reset district options

            if (selectedState && stateDistricts[selectedState]) {
                stateDistricts[selectedState].forEach(district => {
                    const option = document.createElement('option');
                    option.value = district;
                    option.textContent = district;
                    districtDropdown.appendChild(option);
                });
                districtDropdown.style.display = 'block'; // Show district dropdown
            } else {
                districtDropdown.style.display = 'none'; // Hide district dropdown if no state selected or no districts found
            }
        }

        function populateLeaderboardDistricts() {
            const leaderboardStateDropdown = document.getElementById('leaderboardStateFilter');
            const leaderboardDistrictDropdown = document.getElementById('leaderboardDistrictFilter');
            const selectedState = leaderboardStateDropdown.value;

            leaderboardDistrictDropdown.innerHTML = '<option value="">All Districts</option>'; // Reset district options

            if (selectedState && stateDistricts[selectedState]) {
                stateDistricts[selectedState].forEach(district => {
                    const option = document.createElement('option');
                    option.value = district;
                    option.textContent = district;
                    leaderboardDistrictDropdown.appendChild(option);
                });
                leaderboardDistrictDropdown.style.display = 'block'; // Show district dropdown
            } else {
                leaderboardDistrictDropdown.style.display = 'none'; // Hide district dropdown if no state selected or no districts found
            }
        }


        // Function to save Seva application
        async function saveSevaApplication() {
            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const email = document.getElementById('email').value.trim();
            const sevaType = document.getElementById('sevaType').value.trim();
            const state = document.getElementById('state').value.trim(); // Get selected state
            const district = document.getElementById('district').value.trim(); // Get selected district
            const sevaStartDate = document.getElementById('sevaStartDate').value; // Get Seva Start Date
            const sevaEndDate = document.getElementById('sevaEndDate').value; // Get Seva End Date


            if (name && phone && email && sevaType && state && district && sevaStartDate && sevaEndDate) { // Validate all fields including dates
                try {
                    // Save to main SevaApplications collection (for leaderboard)
                    await addDoc(collection(db, 'SevaApplications'), {
                        name, phone, email, sevaType, state, district, // Include state and district in main collection
                        status: 'pending', // Initial status
                        timestamp: new Date(), // Add timestamp
                        sevaStartDate: sevaStartDate, // Save Seva Start Date
                        sevaEndDate: sevaEndDate // Save Seva End Date
                    });

                    // Save to state-specific SevaApplications collection
                    await addDoc(collection(db, 'States', state, 'SevaApplications'), {
                        name, phone, email, sevaType, district,
                        status: 'pending', // Initial status
                        timestamp: new Date(), // Add timestamp
                        sevaStartDate: sevaStartDate, // Save Seva Start Date
                        sevaEndDate: sevaEndDate // Save Seva End Date
                    });

                    alert(`✅ ${name} has successfully applied for Seva in ${district}, ${state} State!`); // Modified alert message to include name, district, and state

                    // ** Send message to state chatroom **
                    const applicationMessage = `📢 New Seva Application: ${name} has applied for ${sevaType} Seva in ${district}, ${state}!`;

                    console.log("Debug: State chatroom name being used:", state); // *** ADD THIS LOG ***
                    console.log("Debug: Calling sendChatroomMessage with:", state, 'Seva Application System', applicationMessage); // *** ADD THIS LOG ***

                    await sendChatroomMessage(state, 'Seva Application System', applicationMessage); // Send message to the state chatroom

                    console.log("Debug: sendChatroomMessage function call completed."); // *** ADD THIS LOG ***


                    // Optionally, automatically try to select an applicant after submission (for testing)
                    // selectNextApplicant(); // You might not want to do this automatically in a real scenario
                } catch (error) {
                    console.error("Error saving Seva application:", error);
                    alert('❌ Error saving Seva application. See console for details.');
                }
            } else {
                alert('⚠️ Please fill in all fields, including State, District, Seva Start and End Dates!'); // Updated alert message
            }
        }

        // Function to select the next pending applicant (No changes here)
        async function selectNextApplicant() {
            // ... (rest of the selectNextApplicant function is the same) ...
            const q = query(collection(db, 'SevaApplications'), orderBy('timestamp'), where('status', '==', 'pending'), limit(1)); // Query for the earliest pending application

            try {
                const querySnapshot = await getDocs(q);
                if (!querySnapshot.empty) {
                    const nextApplicantDoc = querySnapshot.docs[0];
                    const applicantData = querySnapshot.docs[0].data();
                    const applicantName = applicantData.name; // Get applicant's name

                    await updateDoc(doc(db, 'SevaApplications', nextApplicantDoc.id), {
                        status: 'selected'
                    });

                    console.log(`✅ Selected applicant: ${applicantName}`);
                    alert(`✅ Selected applicant: ${applicantName} has been selected for Seva and added to the leaderboard.`); // More informative alert
                    loadLeaderboard(); // Refresh leaderboard to reflect changes

                    // **Send announcement to chatroom**
                    const announcementMessage = `🎉  Applicant "${applicantName}" has been automatically selected for Seva! 🎉`;
                    await sendChatroomMessage('Announcements', 'AI System', announcementMessage); // Send message to "Announcements" chatroom

                } else {
                    console.log("No pending applicants found.");
                    alert("No pending applicants found. No applicant could be selected.");
                }
            } catch (error) {
                console.error("Error selecting next applicant:", error);
                console.error("Full error object:", error); // Log the full error object for details! **DEBUGGING: Check Console for this error**
                // alert('❌ Error selecting next applicant. See console for details.'); // Removed the alert message as requested. Error is still logged in console.
            }
        }

        // Function to reject the currently selected Seva application (No changes here)
        async function rejectCurrentApplicant() {
            // ... (rest of the rejectCurrentApplicant function is the same) ...
            const q = query(collection(db, 'SevaApplications'), where('status', '==', 'selected'), limit(1)); // Query for the currently selected application

            try {
                const querySnapshot = await getDocs(q);
                if (!querySnapshot.empty) {
                    const selectedApplicantDoc = querySnapshot.docs[0];
                    const applicantData = selectedApplicantDoc.data();
                    await rejectSevaApplication(selectedApplicantDoc.id, applicantData.name); // Call rejectSevaApplication with name
                } else {
                    console.log("No applicant currently selected to reject.");
                    alert("No applicant currently selected to reject.");
                }
            } catch (error) {
                console.error("Error rejecting current applicant:", error);
                console.error("Full error object:", error); // Log the full error object for details! **DEBUGGING: Check Console for this error**
                alert('❌ Error rejecting current applicant. See console for details.');
            }
        }


        // Modified rejectSevaApplication to accept applicantName for alert message (No changes here)
        async function rejectSevaApplication(applicationId, applicantName) {
            // ... (rest of the rejectSevaApplication function is the same) ...
            try {
                await updateDoc(doc(db, 'SevaApplications', applicationId), {
                    status: 'rejected'
                });
                console.log(`❌ Rejected application with ID: ${applicationId}`);
                alert(`❌ Applicant ${applicantName} has been rejected for Seva.`); // More informative alert
                selectNextApplicant(); // Automatically select the next applicant after rejection
            } catch (error) {
                console.error("Error rejecting application:", error);
                console.error("Full error object:", error); // Log the full error object for details! **DEBUGGING: Check Console for this error**
                alert('❌ Error rejecting application. See console for details.');
            }
        }

        // Function to load leaderboard data - SIMPLIFIED FOR DEBUGGING
        async function loadLeaderboard() {
            const leaderboardTable = document.getElementById('leaderboardTable');
            const stateFilter = document.getElementById('leaderboardStateFilter').value;
            const districtFilter = document.getElementById('leaderboardDistrictFilter').value;

            // ** Simplest Table Clearing **
            leaderboardTable.innerHTML = ''; // Just use innerHTML for now

            let q;

            // Determine the query based on filters
            if (stateFilter && districtFilter && stateFilter !== 'All States' && districtFilter !== 'All Districts') {
                // Query for specific state AND district
                console.log(`Filtering leaderboard by State: ${stateFilter}, District: ${districtFilter}`); // Debug log
                q = query(collection(db, 'SevaApplications'),
                           where('state', '==', stateFilter),
                           where('district', '==', districtFilter),
                           orderBy('timestamp'));
            } else if (stateFilter && stateFilter !== 'All States') {
                // Query for specific state
                console.log(`Filtering leaderboard by State: ${stateFilter}`); // Debug log
                 q = query(collection(db, 'SevaApplications'),
                           where('state', '==', stateFilter),
                           orderBy('timestamp'));
            }
            else {
                // Query for all applications (no filter)
                console.log("Loading all leaderboard data (no filters)"); // Debug log
                q = query(collection(db, 'SevaApplications'), orderBy('timestamp'));
            }


            const querySnapshot = await getDocs(q);

            // Create table structure
            const table = document.createElement('table');
            table.style.width = '100%';
            table.style.borderCollapse = 'collapse';

            const thead = table.createTHead();
            let headerRow = thead.insertRow();
            const headers = ['Name', 'Seva Type', 'State', 'District', 'Seva Start Date', 'Seva End Date', 'Status']; // ADDED 'District' and Date headers
            headers.forEach(headerText => {
                let th = document.createElement('th');
                th.textContent = headerText;
                th.style.padding = '8px';
                th.style.borderBottom = '2px solid #00e6e6';
                th.style.textAlign = 'left';
                headerRow.appendChild(th);
            });

            const tbody = table.createTBody();

            querySnapshot.forEach((doc) => {
                const data = doc.data();
                let row = tbody.insertRow();

                let nameCell = row.insertCell();
                let sevaTypeCell = row.insertCell();
                let stateCell = row.insertCell();
                let districtCell = row.insertCell(); // ADDED district cell
                let startDateCell = row.insertCell(); // ADDED start date cell
                let endDateCell = row.insertCell();   // ADDED end date cell
                let statusCell = row.insertCell();

                nameCell.textContent = data.name;
                sevaTypeCell.textContent = data.sevaType;
                stateCell.textContent = data.state;
                districtCell.textContent = data.district; // ADDED district data
                startDateCell.textContent = data.sevaStartDate || 'N/A'; // ADDED start date data, handle null
                endDateCell.textContent = data.sevaEndDate || 'N/A';     // ADDED end date data, handle null
                statusCell.textContent = data.status;

                 [nameCell, sevaTypeCell, stateCell, districtCell, startDateCell, endDateCell, statusCell].forEach(cell => { // UPDATED cell list
                    cell.style.padding = '8px';
                    cell.style.borderBottom = '1px solid rgba(0, 230, 230, 0.2);';
                });
            });

            leaderboardTable.innerHTML = table.outerHTML;
        }

        // New function to send message to a specific chatroom (No changes here)
        async function sendChatroomMessage(chatroomName, senderName, messageText) {
            // ... (rest of the sendChatroomMessage function is the same) ...
            if (chatroomName && messageText) {
                try {
                    console.log("Sending message to chatroom:", chatroomName, "Sender:", senderName, "Text:", messageText); // Log before sending
                    const docRef = await addDoc(collection(db, 'chatrooms', chatroomName, 'messages'), {
                        sender: senderName,
                        text: messageText,
                        timestamp: new Date()
                    });
                    console.log(`✅ Message sent to chatroom "${chatroomName}" with ID:`, docRef.id, "Text:", messageText); // Log success with doc ID
                } catch (error) {
                    console.error(`❌ Error sending message to chatroom "${chatroomName}":`, error);
                    console.error("Full error object:", error); // Log the full error object for details! **DEBUGGING: Check Console for this error**
                    alert(`Error sending message to Announcements chatroom. See console for details.`); // Alert user of error
                }
            }
        }

        // --- Theme Functionality ---
        const themeClassPrefix = 'theme-';
        const themeClasses = ['default', 'dark-a', 'white', 'theme4', 'theme5', 'neon-orange', 'neon-green', 'white-neon-blue', 'neon-blue']; // ADDED new themes

        function setTheme(themeName) {
            const body = document.body;
            // Remove any existing theme classes
            themeClasses.forEach(theme => {
                body.classList.remove(themeClassPrefix + theme);
            });
            // Add the new theme class
            if (themeName !== 'default') { // Don't add class for default theme
                body.classList.add(themeClassPrefix + themeName);
            }
            localStorage.setItem('selectedTheme', themeName); // Store selected theme
        }

        function applyStoredTheme() {
            const storedTheme = localStorage.getItem('selectedTheme');
            if (storedTheme) {
                setTheme(storedTheme);
            } else {
                setTheme('neon-green'); // Default theme on first load is now neon-green
            }
        }

        // --- "Add from Contacts" Functionality (Simplified) ---
        let selectedContactName = null;

        function addFromContacts() {
            selectedContactName = prompt("Enter contact name:"); // Simplified contact selection
            if (selectedContactName) {
                document.getElementById('messageText').value += `To: ${selectedContactName} `; // Prepend message
                alert(`Sending message to contact: ${selectedContactName} (Simplified Feature)`);
            }
        }

        // --- Admin Dashboard Functionality ---
        async function loadAdminDashboardApplications() {
            const adminDashboardTable = document.getElementById('adminDashboardTable');
            adminDashboardTable.innerHTML = ''; // Clear table

            const q = query(collection(db, 'SevaApplications'), where('status', '==', 'pending'), orderBy('timestamp'));

            const querySnapshot = await getDocs(q);

            if (querySnapshot.empty) {
                adminDashboardTable.innerHTML = '<tr><td colspan="7">No pending applications.</td></tr>';
                return;
            }

            const table = document.createElement('table');
            table.style.width = '100%';
            table.style.borderCollapse = 'collapse';

            const thead = table.createTHead();
            let headerRow = thead.insertRow();
            const headers = ['Name', 'Seva Type', 'State', 'District', 'Seva Start', 'Seva End', 'Actions'];
            headers.forEach(headerText => {
                let th = document.createElement('th');
                th.textContent = headerText;
                th.style.padding = '8px';
                th.style.borderBottom = '2px solid #ff9933'; // Neon orange header border
                th.style.textAlign = 'left';
                headerRow.appendChild(th);
            });

            const tbody = table.createTBody();
            querySnapshot.forEach(doc => {
                const data = doc.data();
                const row = tbody.insertRow();

                row.insertCell().textContent = data.name;
                row.insertCell().textContent = data.sevaType;
                row.insertCell().textContent = data.state;
                row.insertCell().textContent = data.district;
                row.insertCell().textContent = data.sevaStartDate || 'N/A';
                row.insertCell().textContent = data.sevaEndDate || 'N/A';

                const actionsCell = row.insertCell();
                const approveButton = document.createElement('button');
                approveButton.textContent = 'Approve';
                approveButton.classList.add('admin-action-button', 'approve-button'); // Add classes for styling
                approveButton.onclick = async () => {
                    await approveSevaApplication(doc.id, data.name, data.district, data.state);
                };
                actionsCell.appendChild(approveButton);

                const rejectButton = document.createElement('button');
                rejectButton.textContent = 'Reject';
                rejectButton.classList.add('admin-action-button', 'reject-button'); // Add classes for styling
                rejectButton.onclick = async () => {
                    await rejectSevaApplicationAdmin(doc.id, data.name, data.district, data.state);
                };
                actionsCell.appendChild(rejectButton);

                [...row.cells].forEach(cell => {
                    cell.style.padding = '8px';
                    cell.style.borderBottom = '1px solid rgba(255, 153, 51, 0.3)'; // Neon orange row border
                });
            });
            adminDashboardTable.appendChild(table);
        }

        async function approveSevaApplication(applicationId, applicantName, district, state) {
            try {
                await updateDoc(doc(db, 'SevaApplications', applicationId), { status: 'approved' });
                // Update state-specific collection too
                const stateApplicationsRef = doc(db, 'States', state, 'SevaApplications', applicationId);
                await updateDoc(stateApplicationsRef, { status: 'approved' });

                console.log(`✅ Application ID: ${applicationId} approved.`);
                alert(`✅ Application for ${applicantName} in ${district}, ${state} approved!`);
                loadAdminDashboardApplications(); // Refresh admin dashboard
                loadLeaderboard(); // Refresh leaderboard
            } catch (error) {
                console.error("Error approving application:", error);
                alert('❌ Error approving application. See console for details.');
            }
        }


        async function rejectSevaApplicationAdmin(applicationId, applicantName, district, state) {
            try {
                await updateDoc(doc(db, 'SevaApplications', applicationId), { status: 'rejected' });
                 // Update state-specific collection too
                const stateApplicationsRef = doc(db, 'States', state, 'SevaApplications', applicationId);
                await updateDoc(stateApplicationsRef, { status: 'rejected' });

                console.log(`❌ Application ID: ${applicationId} rejected.`);
                alert(`❌ Application for ${applicantName} in ${district}, ${state} rejected.`);
                loadAdminDashboardApplications(); // Refresh admin dashboard
                loadLeaderboard(); // Refresh leaderboard
            } catch (error) {
                console.error("Error rejecting application:", error);
                alert('❌ Error rejecting application. See console for details.');
            }
        }


        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById('submitSeva').addEventListener('click', saveSevaApplication);
            document.getElementById('sendMessage').addEventListener('click', sendMessage);
            document.getElementById('showLeaderboard').addEventListener('click', loadLeaderboard); // Load leaderboard on button click
            document.getElementById('fileInput-trigger').addEventListener('click', function() { // Trigger file input click
                document.getElementById('fileInput').click();
            });
            document.getElementById('fileInput').addEventListener('change', handleFileUpload); // File Upload Event Listener
            document.getElementById('groupProfileIcon').addEventListener('click', toggleGroupSettings); // Toggle group settings on group profile icon click
            document.getElementById('closeGroupSettingsButton').addEventListener('click', closeGroupSettings); // Close group settings button
            document.getElementById('accountSettingsIcon').addEventListener('click', toggleAccountSettings); // Toggle account icon click
            document.getElementById('closeAccountSettings').addEventListener('click', closeAccountSettings); // Close account settings button
            document.getElementById('adminDashboardButton').addEventListener('click', toggleAdminDashboard); // Admin Dashboard Button
            document.getElementById('askGeminiButton').addEventListener('click', askGeminiAI); // Gemini AI Button
            document.getElementById('settingsButtonSidebar').addEventListener('click', showSettingsSection); // Settings button in sidebar
            document.getElementById('closeSettingsSidebar').addEventListener('click', hideSettingsSection); // Close settings in sidebar
            document.getElementById('state').addEventListener('change', populateDistricts); // State dropdown change event
            document.getElementById('leaderboardStateFilter').addEventListener('change', populateLeaderboardDistricts); // Leaderboard State filter
            document.getElementById('leaderboardStateFilter').addEventListener('change', loadLeaderboard); // Leaderboard State filter load
            document.getElementById('leaderboardDistrictFilter').addEventListener('change', loadLeaderboard); // Leaderboard District filter load
            document.getElementById('addContactButton').addEventListener('click', addFromContacts); // Add contact button

            // Theme selection event listeners - Sidebar Settings
            document.querySelectorAll('.theme-option-sidebar').forEach(option => {
                option.addEventListener('click', function() {
                    const theme = this.dataset.theme;
                    setTheme(theme);
                    hideSettingsSection(); // Close settings after theme change
                });
            });

            // Theme selection event listeners - Account Settings Dropdown
            document.querySelectorAll('.account-settings-dropdown .theme-option').forEach(option => { // Correct selector
                option.addEventListener('click', function() {
                    const theme = this.dataset.theme;
                    setTheme(theme);
                    closeAccountSettings(); // Close dropdown after theme change
                });
            });


            document.getElementById('messageText').addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault(); // Prevent default form submission
                    sendMessage();
                }
            });


            applyStoredTheme(); // Apply theme on page load from localStorage
            populateDistricts(); // Initial district dropdown setup (hide initially)
            populateLeaderboardDistricts(); // Initial leaderboard district dropdown setup
            loadLeaderboard(); // Load leaderboard initially
        });

        // Chat Functionality (rest of your chat functions remain the same, but sendMessage is modified below)
        let currentChatState = null;
        let currentSenderName = 'Team 1 CO'; // **Set your default sender name here, or get it dynamically**
        let isGroupSettingsVisible = false; // Track group settings visibility
        let isAccountSettingsVisible = false; // Track account settings visibility
        let isAdminDashboardVisible = false; // Track admin dashboard visibility
        let isAdminSettingsSidebarVisible = false; // Track sidebar settings visibility
        let adminDashboardButton = document.getElementById('adminDashboardButton'); // Get the admin dashboard button
        let settingsButtonSidebar = document.getElementById('settingsButtonSidebar'); // Get the settings button
        let unreadMessages = {}; // Track unread messages for each chatroom


        async function openChatroom(stateName) {
            currentChatState = stateName;
            showSection('chatSection');
            document.getElementById('currentChatStateName').textContent = stateName;
            document.getElementById('groupProfileIcon').querySelector('span').textContent = stateName.substring(0, 2).toUpperCase(); // Set initials in group profile icon
            // ** In a real app, you would fetch and display group members here from Firestore **
            const members = ['Member 1', 'Member 2', '...']; // Placeholder members
            displayGroupMembers(members);
            console.log("openChatroom called for:", stateName); // ADD THIS LOG

            // Clear unread indicator when chatroom is opened
            clearUnreadIndicator(stateName);
            delete unreadMessages[stateName]; // Clear count

            if (stateName === 'Kathas List') {
                displayKathasListTable(); // Call function to display Kathas table
                document.getElementById('messageText').style.display = 'none'; // Hide message input
                document.getElementById('sendMessage').style.display = 'none'; // Hide send button
                document.querySelector('.file-upload-container').style.display = 'none'; // Hide file upload
                document.getElementById('addContactButton').style.display = 'none'; // Hide Add Contact button
            } else {
                loadMessages(stateName); // Load messages for other chatrooms
                document.getElementById('messageText').style.display = 'inline-block'; // Show message input
                document.getElementById('sendMessage').style.display = 'inline-block'; // Show send button
                document.querySelector('.file-upload-container').style.display = 'inline-flex'; // Show file upload
                document.getElementById('addContactButton').style.display = 'inline-block'; // Show Add Contact button
            }
            closeGroupSettings(); // Ensure chat view is shown initially when opening chatroom
            closeAccountSettings(); // Ensure account settings are closed when opening chatroom
            hideAdminDashboard(); // Ensure admin dashboard is closed when opening chatroom
            hideGeminiSection(); // Ensure gemini section is closed when opening chatroom
            hideSettingsSection(); // Ensure settings sidebar is closed when opening chatroom
        }

        function displayGroupMembers(members) {
            const groupMembersList = document.getElementById('groupMembersList');
            groupMembersList.innerHTML = ''; // Clear previous list
            members.forEach(member => {
                const li = document.createElement('li');
                li.textContent = member;
                groupMembersList.appendChild(li);
            });
        }

        function toggleGroupSettings() {
            isGroupSettingsVisible = !isGroupSettingsVisible;
            const chatMessageContainer = document.getElementById('chatMessageContainer');
            const groupSettingsPage = document.getElementById('groupSettingsPage');

            if (isGroupSettingsVisible) {
                chatMessageContainer.style.display = 'none';
                groupSettingsPage.style.display = 'flex'; // Use flex to display group settings page
                closeAccountSettings(); // Close account settings if open
                hideAdminDashboard(); // Hide admin dashboard if open
                hideGeminiSection(); // Hide gemini section if open
                hideSettingsSection(); // Close settings sidebar if open
            } else {
                chatMessageContainer.style.display = 'flex'; // Use flex to display chat message container
                groupSettingsPage.style.display = 'none';
            }
        }

        function closeGroupSettings() {
            isGroupSettingsVisible = false;
            const chatMessageContainer = document.getElementById('chatMessageContainer');
            const groupSettingsPage = document.getElementById('groupSettingsPage');

            chatMessageContainer.style.display = 'flex'; // Ensure chat message container is visible
            groupSettingsPage.style.display = 'none'; // Hide group settings page
        }

        function toggleAccountSettings() {
            isAccountSettingsVisible = !isAccountSettingsVisible;
            const accountSettingsDropdown = document.getElementById('accountSettingsDropdown');

            if (isAccountSettingsVisible) {
                accountSettingsDropdown.style.display = 'block';
                closeGroupSettings(); // Close group settings if open
                hideAdminDashboard(); // Hide admin dashboard if open
                hideGeminiSection(); // Hide gemini section if open
                hideSettingsSection(); // Close settings sidebar if open
            } else {
                accountSettingsDropdown.style.display = 'none';
            }
        }

        function closeAccountSettings() {
            isAccountSettingsVisible = false;
            const accountSettingsDropdown = document.getElementById('accountSettingsDropdown');
            accountSettingsDropdown.style.display = 'none';
        }

        function toggleAdminDashboard() {
            const adminPassword = prompt("Enter Admin Password:");
            if (adminPassword === "shiv") { // ** IMPORTANT: Replace "shiv" with a stronger password or secure authentication method in production! **
                isAdminDashboardVisible = !isAdminDashboardVisible;
                const chatSection = document.getElementById('chatSection');
                const adminDashboardSection = document.getElementById('adminDashboardSection');
                const adminDashboardButton = document.getElementById('adminDashboardButton'); // Get the button again to update text

                 if (isAdminDashboardVisible) {
                    chatSection.style.display = 'none';
                    adminDashboardSection.style.display = 'block';
                    closeGroupSettings();
                    closeAccountSettings();
                    hideGeminiSection();
                    hideSettingsSection();
                    adminDashboardButton.textContent = '❌ Close Admin Dashboard'; // Change button text to indicate active state
                    loadAdminDashboardApplications(); // Load applications in admin dashboard
                    loadLeaderboard(); // Refresh leaderboard
                    setTheme('neon-orange'); // Set neon orange theme for admin dashboard
                    displayMonthlySchedule(); // Call function to display monthly schedule when dashboard opens
                } else {
                    chatSection.style.display = 'block';
                    adminDashboardSection.style.display = 'none';
                    adminDashboardButton.textContent = '⚙️ Admin Dashboard ⚙️'; // Change back to original text
                    setTheme(localStorage.getItem('selectedTheme') || 'neon-green'); // Revert to user's theme or default
                }
            } else if (adminPassword !== null) {
                alert("Incorrect Password. Access Denied.");
            }
        }


        function hideAdminDashboard() {
            isAdminDashboardVisible = false;
            const chatSection = document.getElementById('chatSection');
            const adminDashboardSection = document.getElementById('adminDashboardSection');
            const adminDashboardButton = document.getElementById('adminDashboardButton'); // Get the button again to update text

            chatSection.style.display = 'block';
            adminDashboardSection.style.display = 'none';
            adminDashboardButton.textContent = '⚙️ Admin Dashboard ⚙️'; // Change back to original text
            setTheme(localStorage.getItem('selectedTheme') || 'neon-green'); // Revert to user's theme or default
        }

        function showGeminiSection() {
            showSection('geminiSection');
            closeGroupSettings();
            closeAccountSettings();
            hideAdminDashboard();
            hideSettingsSection();
        }

        function hideGeminiSection() {
            const geminiSection = document.getElementById('geminiSection');
            const contentDiv = document.querySelector('.content');
            geminiSection.style.display = 'none';
            contentDiv.style.display = 'flex'; // Ensure content area is visible
        }

        function showSettingsSection() {
            isAdminSettingsSidebarVisible = true;
            document.getElementById('sidebarButtons').style.display = 'none'; // Hide main buttons
            document.getElementById('settingsSidebarSection').style.display = 'block'; // Show settings section
            hideGeminiSection();
            closeGroupSettings();
            closeAccountSettings();
            hideAdminDashboard();
        }

        function hideSettingsSection() {
            isAdminSettingsSidebarVisible = false;
            document.getElementById('sidebarButtons').style.display = 'block'; // Show main buttons
            document.getElementById('settingsSidebarSection').style.display = 'none'; // Hide settings section
        }


        async function askGeminiAI() {
            const question = document.getElementById('geminiQuestionInput').value;
            const geminiResponseDiv = document.getElementById('geminiResponse');
            geminiResponseDiv.textContent = 'Thinking...';

            const apiKey = 'AIzaSyD-NFL8ghMMf4ibko6AxGXRsp3zhzNZ-Bk'; // **IMPORTANT: API KEY IS EXPOSED IN CLIENT-SIDE CODE - SECURITY RISK!**
            // **SECURITY WARNING!**  Exposing your API key in client-side code is a major security vulnerability.
            // In a production application, you MUST move the Gemini API call to a backend server.
            // Your frontend should send the question to your server, and your server should make the API call
            // using the API key securely stored on the server.

            // **IMPORTANT:**  REPLACE THIS URL WITH THE CORRECT GEMINI API URL FROM THE OFFICIAL DOCUMENTATION!
            // **HOW TO FIND THE CORRECT URL:**
            // 1. Google Search: "Google Gemini API documentation"
            // 2. Look for the official Google AI for Developers documentation.
            // 3. Find the REST API reference section.
            // 4. Navigate to the documentation for the `generateContent` method for the Gemini Pro model.
            // 5. The documentation will show you the base URL and endpoint for `generateContent`.
            const apiUrl = 'YOUR_CORRECT_GEMINI_API_URL_HERE'; // <-- **REPLACE THIS PLACEHOLDER!**

            const requestOptions = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Goog-Api-Key': apiKey
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{ text: question }]
                    }]
                })
            };

            try {
                const response = await fetch(apiUrl, requestOptions);
                if (!response.ok) { // Check if response was successful (status code 2xx)
                    console.error(`Gemini API HTTP error! status: ${response.status}`);
                    geminiResponseDiv.textContent = 'Error: Could not retrieve response from Gemini AI. HTTP error.';
                    return; // Exit the function if there's an HTTP error
                }
                const data = await response.json();

                if (data.candidates && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts[0].text) {
                    geminiResponseDiv.textContent = data.candidates[0].content.parts[0].text;
                } else {
                    geminiResponseDiv.textContent = 'Error: Could not retrieve response from Gemini AI. No text in response.';
                    console.error('Gemini AI response error:', data);
                }
            } catch (error) {
                geminiResponseDiv.textContent = 'Error communicating with Gemini AI. See console.';
                console.error('Error asking Gemini AI:', error);
            }
        }


        async function loadMessages(stateName) {
            console.log("loadMessages called for:", stateName); // ADD THIS LOG
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = '';

            const chatRef = collection(db, 'chatrooms', stateName, 'messages');
            const q = query(chatRef, orderBy('timestamp'));

            onSnapshot(q, (querySnapshot) => {
                chatMessages.innerHTML = '';
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const messageDiv = document.createElement('div');
                    messageDiv.classList.add('message-container'); // Container for avatar and message
                    let messageContent = '';

                    // --- Avatar/Initials ---
                    const avatarDiv = document.createElement('div');
                    avatarDiv.classList.add('message-avatar');
                    avatarDiv.textContent = data.sender.substring(0, 2).toUpperCase(); // Initials
                    messageDiv.appendChild(avatarDiv);

                    const messageTextDiv = document.createElement('div'); // Div for message text content
                    messageTextDiv.classList.add('message-text-content');

                    if (data.type === 'text') {
                        messageContent = `<strong>${data.sender}:</strong> ${data.text}`;
                    } else if (data.type === 'file') {
                        messageContent = `<strong>${data.sender}:</strong> <a href="${data.fileUrl}" target="_blank">📄 ${data.fileName}</a>`;
                    }

                    const timestamp = data.timestamp ? new Date(data.timestamp.toDate()) : new Date(); // Handle potential null timestamp and convert to Date object
                    const formattedTime = timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }); // Format time

                    messageTextDiv.innerHTML = `${messageContent} <span class="message-time">(${formattedTime})</span>`;


                    if (data.sender === currentSenderName) {
                        messageTextDiv.classList.add('other-message'); // User's own messages on right
                        messageDiv.classList.add('sent-message'); // Apply class to message container for alignment
                    } else {
                        messageTextDiv.classList.add('user-message'); // Received messages on left
                        messageDiv.classList.add('received-message'); // Apply class to message container for alignment
                    }

                    // ---  DELETE BUTTONS ---
                    if (isAdminUser(currentSenderName)) {
                        const deleteButton = document.createElement('button');
                        deleteButton.classList.add('admin-delete-button');
                        deleteButton.innerHTML = '<i class="fas fa-trash-alt"></i>'; // Trash icon for delete
                        deleteButton.onclick = function() {
                            if (confirm('Are you sure you want to delete this message? (Admin Delete)')) {
                                deleteChatMessage(stateName, doc.id, true); // isAdminDelete = true
                            }
                        };
                        messageTextDiv.appendChild(deleteButton);
                    } else if (data.sender === currentSenderName) { // User delete for own messages
                        const deleteButton = document.createElement('button');
                        deleteButton.classList.add('delete-button');
                        deleteButton.innerHTML = '<i class="fas fa-trash-alt"></i>'; // Trash icon for delete
                        deleteButton.onclick = function() {
                            if (confirm('Are you sure you want to delete this message?')) {
                                deleteChatMessage(stateName, doc.id); // isAdminDelete defaults to false
                            }
                        };
                        messageTextDiv.appendChild(deleteButton);
                    }

                    messageDiv.appendChild(messageTextDiv); // Append message text content to message container
                    chatMessages.appendChild(messageDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;

                    // --- Unread Message Indicator Logic ---
                    if (stateName !== currentChatState) { // If message is in a chatroom that's NOT currently open
                        markChatroomUnread(stateName);
                    }
                });
            });
        }

        function markChatroomUnread(stateName) {
            const chatroomButton = Array.from(document.querySelectorAll('.state-list button')).find(button => button.textContent === stateName);
            if (chatroomButton && !chatroomButton.classList.contains('unread-indicator')) {
                chatroomButton.classList.add('unread-indicator');
                // Optionally, increment unread message count (for numeric badge)
                if (unreadMessages[stateName]) {
                    unreadMessages[stateName]++;
                } else {
                    unreadMessages[stateName] = 1;
                }
                updateUnreadBadge(stateName, unreadMessages[stateName]);
            }
        }

        function clearUnreadIndicator(stateName) {
            const chatroomButton = Array.from(document.querySelectorAll('.state-list button')).find(button => button.textContent === stateName);
            if (chatroomButton) {
                chatroomButton.classList.remove('unread-indicator');
                clearUnreadBadge(stateName);
            }
        }

        function updateUnreadBadge(stateName, count) {
            const chatroomButton = Array.from(document.querySelectorAll('.state-list button')).find(button => button.textContent === stateName);
            if (chatroomButton) {
                let badge = chatroomButton.querySelector('.unread-badge');
                if (!badge) {
                    badge = document.createElement('span');
                    badge.classList.add('unread-badge');
                    chatroomButton.appendChild(badge);
                }
                badge.textContent = count > 9 ? '9+' : count; // Show '9+' if more than 9
            }
        }

        function clearUnreadBadge(stateName) {
             const chatroomButton = Array.from(document.querySelectorAll('.state-list button')).find(button => button.textContent === stateName);
             if (chatroomButton) {
                const badge = chatroomButton.querySelector('.unread-badge');
                if (badge) {
                    badge.remove(); // Simply remove the badge when cleared
                }
             }
        }


        async function sendMessage() {
            const messageText = document.getElementById('messageText').value.trim();
            if (messageText && currentChatState) {
                try {
                    let fullMessageText = messageText;
                    if (selectedContactName) {
                        fullMessageText = `To: ${selectedContactName} - ${messageText}`; // Prepend contact name
                        selectedContactName = null; // Clear contact name after sending
                    }

                    await addDoc(collection(db, 'chatrooms', currentChatState, 'messages'), {
                        sender: currentSenderName, // Use currentSenderName here
                        text: fullMessageText, // Use the modified message text
                        timestamp: new Date(),
                        type: 'text' // Message type is text
                    });
                    document.getElementById('messageText').value = '';


                    // **Rejection Message Detection Logic**
                    const lowerCaseMessage = messageText.toLowerCase();
                    if (currentSenderName === 'Team 1 CO' && (lowerCaseMessage.includes("cannot come to work this month") || lowerCaseMessage.includes("cannot come to work") || lowerCaseMessage.includes("cannot work this month") || lowerCaseMessage.includes("cannot work"))) {
                        console.log("Rejection message detected from Team 1 CO.");
                        alert("Team 1 CO has indicated they cannot select the current applicant. Releasing current applicant and selecting next if available. Anyone can apply for Seva.");
                        await rejectCurrentApplicant(); // Trigger rejection and re-selection flow
                    }


                } catch (error) {
                    console.error("Error sending message:", error);
                    console.error("Full error object:", error);
                    alert('Error sending message.');
                }
            }
        }

        // --- Delete Chat Message Function ---
        async function deleteChatMessage(chatroomName, messageId, isAdminDelete = false) {
            try {
                await deleteDoc(doc(db, 'chatrooms', chatroomName, 'messages', messageId));
                console.log(`✅ Message deleted successfully. Message ID: ${messageId}, Chatroom: ${chatroomName}${isAdminDelete ? ' (Admin Delete)' : ''}`);
                if (isAdminDelete) {
                    alert('Message deleted by Admin.');
                }
            } catch (error) {
                console.error("❌ Error deleting message:", error);
                console.error("Full error object:", error);
                alert('Error deleting message. See console for details.');
            }
        }

        // --- File Upload Handlers ---
        async function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            if (!currentChatState) {
                alert('Please select a chatroom first.');
                return;
            }

            const storageRef = ref(storage, `chat-files/${currentChatState}/${file.name}`);

            try {
                // --- File Upload Feedback: Show preview for images ---
                let filePreviewUrl = null;
                if (file.type.startsWith('image/')) {
                    filePreviewUrl = URL.createObjectURL(file);
                    // Display preview (you can append an image element to chatMessages temporarily)
                    // alert('File uploading... Preview available in console.'); // Removed alert
                    console.log('File Preview URL (image only):', filePreviewUrl); // Log URL for preview
                    // In a real app, you'd display this preview in the chat UI itself.
                    // For now, let's add a message to chat saying "Image Uploading..."
                    await addDoc(collection(db, 'chatrooms', currentChatState, 'messages'), {
                        sender: currentSenderName,
                        text: `[File Uploading: ${file.name}]`, // Show "Uploading..." message
                        timestamp: new Date(),
                        type: 'text' // Use text type for this temp message
                    });

                } else {
                    // alert('File uploading...'); // Removed alert
                    // For other file types, show "File Uploading..." message
                    await addDoc(collection(db, 'chatrooms', currentChatState, 'messages'), {
                        sender: currentSenderName,
                        text: `[File Uploading: ${file.name}]`, // Show "Uploading..." message
                        timestamp: new Date(),
                        type: 'text' // Use text type for this temp message
                    });
                }


                const snapshot = await uploadBytes(storageRef, file);
                const downloadURL = await getDownloadURL(snapshot.ref);

                // After successful upload, send the file message
                await addDoc(collection(db, 'chatrooms', currentChatState, 'messages'), {
                    sender: currentSenderName, // Use currentSenderName
                    fileName: file.name,
                    fileUrl: downloadURL,
                    timestamp: new Date(),
                    type: 'file' // Message type is file
                });

                console.log('File uploaded successfully!', downloadURL);
                // alert('File uploaded and sent successfully!'); // Removed alert - success is now in chat

                // Add success message to chat
                await addDoc(collection(db, 'chatrooms', currentChatState, 'messages'), {
                    sender: 'System', // Use "System" sender for success message
                    text: `✅ File "${file.name}" uploaded successfully!`,
                    timestamp: new Date(),
                    type: 'text' // Use text type for success message
                });


            } catch (error) {
                console.error('Error uploading file:', error);
                alert('Error uploading file. See console for details.');
            } finally {
                // Clear the file input after upload
                document.getElementById('fileInput').value = '';
            }
        }


        function showSection(sectionId) {
            document.querySelectorAll('.seva-section, .donation-section, .leaderboard-section, .chat-section, .admin-dashboard-section, .gemini-section')
                .forEach(section => section.style.display = 'none');
            document.getElementById(sectionId).style.display = 'block';
        }

        window.showSection = showSection;
        window.openChatroom = openChatroom;
        window.selectNextApplicant = selectNextApplicant; // Make globally accessible for testing
        window.rejectSevaApplication = rejectSevaApplication; // Make globally accessible for testing
        window.rejectCurrentApplicant = rejectCurrentApplicant; // Make globally accessible for testing
        window.sendChatroomMessage = sendChatroomMessage; // Make globally accessible for testing
        window.deleteChatMessage = deleteChatMessage; // Make globally accessible for testing
        window.toggleGroupSettings = toggleGroupSettings; // Make globally accessible for testing
        window.closeGroupSettings = closeGroupSettings; // Make globally accessible for testing
        window.toggleAccountSettings = toggleAccountSettings; // Make toggleAccountSettings globally accessible
        window.closeAccountSettings = closeAccountSettings; // Make closeAccountSettings globally accessible
        window.setTheme = setTheme; // Make setTheme globally accessible
        window.toggleAdminDashboard = toggleAdminDashboard; // Make toggleAdminDashboard globally accessible
        window.hideAdminDashboard = hideAdminDashboard; // Make hideAdminDashboard globally accessible
        window.showGeminiSection = showGeminiSection; // Make showGeminiSection globally accessible
        window.hideGeminiSection = hideGeminiSection; // Make hideGeminiSection globally accessible
        window.askGeminiAI = askGeminiAI; // Make askGeminiAI globally accessible
        window.showSettingsSection = showSettingsSection; // Make showSettingsSection globally accessible
        window.hideSettingsSection = hideSettingsSection; // Make hideSettingsSection globally accessible
        window.populateDistricts = populateDistricts; // Make populateDistricts globally accessible
        window.populateLeaderboardDistricts = populateLeaderboardDistricts; // Make populateLeaderboardDistricts globally accessible
        window.loadLeaderboard = loadLeaderboard; // Make loadLeaderboard globally accessible
        window.addFromContacts = addFromContacts; // Make addFromContacts globally accessible
        window.approveSevaApplication = approveSevaApplication; // Make approveSevaApplication globally accessible
        window.rejectSevaApplicationAdmin = rejectSevaApplicationAdmin; // Make rejectSevaApplicationAdmin globally accessible


        function displayKathasListTable() {
            const kathasList = [
                { date: '2025-01-04', location: 'खुर्री हालेकोसा राजनन्दगाँव', status: 'Completed', dateDisplay: '4 से 10 जनवरी 2025' },
                { date: '2025-01-16', location: 'सूरत गुजरात', status: 'Completed', dateDisplay: '16 से 22 जनवरी 2025' },
                { date: '2025-01-24', location: 'साकरी महाराष्ट्र', status: 'Completed', dateDisplay: '24 से 30 जनवरी 2025' },
                { date: '2025-02-01', location: 'कांकेर  छत्तीसगढ़', status: 'Completed', dateDisplay: '1 से 7 फरवरी 2025' },
                { date: '2025-02-09', location: 'फरीदाबाद (हरयाणा) – सेक्टर नंबर 12 के ग्राउंड इंडियन आयल RD के सामने', status: 'Completed', dateDisplay: '9 फरवरी 2025' },
                { date: '2025-02-10', location: 'प्रयागराज', status: 'Completed', dateDisplay: '10 से 16 फरवरी 2025' },
                { date: '2025-02-17', location: 'ताराबाबा की कुटिया सिरसा', status: 'Completed', dateDisplay: '17 से 23 फरवरी 2025' },
                { date: '2025-02-25', location: 'रुद्राक्ष महोत्सव सीहोर', status: 'Completed', dateDisplay: '25 फरवरी से 3 मार्च 2025' },
                { date: '2025-03-06', location: 'भटिंडा पंजाब', status: 'LIVE', dateDisplay: '6 से 10 मार्च 2025' },
                { date: '2025-03-21', location: 'जशपुर छत्तीसगढ़', status: 'Upcoming', dateDisplay: '21 से 28 मार्च 2025' },
                { date: '2025-04-11', location: 'रतनगढ़ राजस्थान', status: 'Upcoming', dateDisplay: '11 से 17 अप्रैल 2025' },
                { date: '2025-04-21', location: 'सिघेस्वर बिहार', status: 'Upcoming', dateDisplay: '21 से 27 अप्रैल 2025' }
            ];

            // Sort Kathas by date ascending (opposite order)
            kathasList.sort((a, b) => new Date(a.date) - new Date(b.date));


            const chatMessagesDiv = document.getElementById('chatMessages');
            chatMessagesDiv.innerHTML = ''; // Clear existing messages

            const table = document.createElement('table');
            table.style.width = '100%';
            table.style.borderCollapse = 'collapse';
            table.style.marginTop = '10px';

            const thead = table.createTHead();
            let headerRow = thead.insertRow();
            const headers = ['Date', 'Location', 'Status'];
            headers.forEach(headerText => {
                let th = document.createElement('th');
                th.textContent = headerText;
                th.style.borderBottom = '2px solid #00e6e6'; // Style header border
                th.style.padding = '8px';
                th.style.textAlign = 'left';
                headerRow.appendChild(th);
            });

            const tbody = table.createTBody();
            kathasList.forEach(katha => {
                let row = tbody.insertRow();
                let dateCell = row.insertCell();
                let locationCell = row.insertCell();
                let statusCell = row.insertCell();

                dateCell.textContent = katha.dateDisplay;
                locationCell.textContent = katha.location;
                statusCell.textContent = katha.status;

                [dateCell, locationCell, statusCell].forEach(cell => {
                    cell.style.borderBottom = '1px solid #004080'; // Style cell border
                    cell.style.padding = '8px';
                });
            });

            chatMessagesDiv.appendChild(table);
        }

        // --- Monthly Schedule Display Functions ---

        // --- Team and Month Data ---
        const teamNames = [
            "Team January Jaguars",
            "Team February Falcons",
            "Team March Mavericks",
            "Team April Avengers",
            "Team May Monarchs",
            "Team June Jets",
            "Team July Giants",
            "Team August Aces",
            "Team September Spartans",
            "Team October Owls",
            "Team November Nomads",
            "Team December Dynamos"
        ];

        const months = [
            "January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];

        const monthlySchedule = {};
        months.forEach((month, index) => {
            monthlySchedule[month] = teamNames[index];
        });

        function displayMonthlySchedule() {
            const scheduleDisplayDiv = document.getElementById('monthlyScheduleDisplay');
            scheduleDisplayDiv.innerHTML = ''; // Clear previous content

            const table = document.createElement('table');
            table.style.width = '100%';
            table.style.borderCollapse = 'collapse';
            table.style.marginTop = '10px';

            const thead = table.createTHead();
            let headerRow = thead.insertRow();
            const headers = ['Month', 'Assigned Team'];
            headers.forEach(headerText => {
                let th = document.createElement('th');
                th.textContent = headerText;
                th.style.borderBottom = '2px solid #ff9933'; // Neon orange header border
                th.style.padding = '8px';
                th.style.textAlign = 'left';
                headerRow.appendChild(th);
            });

            const tbody = table.createTBody();
            months.forEach(month => {
                let row = tbody.insertRow();
                let monthCell = row.insertCell();
                let teamCell = row.insertCell();

                monthCell.textContent = month;
                teamCell.textContent = monthlySchedule[month];

                [monthCell, teamCell].forEach(cell => {
                    cell.style.borderBottom = '1px solid rgba(255, 153, 51, 0.3)'; // Neon orange row border
                    cell.style.padding = '8px';
                });
            });

            scheduleDisplayDiv.appendChild(table);
        }


    </script>

    <style>
        body {
            background: linear-gradient(135deg, #001a33, #004080);
            color: #fff;
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            /*overflow: hidden;  REMOVED THIS LINE TO ENABLE SCROLLING */
        }

        /* --- Theme: Default (Existing Styles - Enhanced Glows) --- */
        body.theme-default {
            background: linear-gradient(135deg, #001a33, #004080);
            color: #fff;
        }
        body.theme-default .sidebar {
            background-color: #00264d;
            box-shadow: 0 0 40px #00e6e6; /* Stronger sidebar shadow */
        }
        body.theme-default .sidebar-buttons button {
            background-color: #00e6e6;
            color: #001a33;
            box-shadow: 0 0 30px #00e6e6; /* Stronger button shadow */
        }
        body.theme-default .seva-section, body.theme-default .donation-section, body.theme-default .leaderboard-section, body.theme-default .chat-section, body.theme-default .admin-dashboard-section, body.theme-default .gemini-section {
            background: rgba(0, 26, 51, 0.9);
            border: 3px solid #00e6e6;
            box-shadow: 0 0 50px #00e6e6; /* Stronger section shadow */
        }
        body.theme-default .seva-section h2, body.theme-default .donation-section h2, body.theme-default .leaderboard-section h2, body.theme-default .chat-section h2, body.theme-default .admin-dashboard-section h2, body.theme-default .gemini-section h2 {
            text-shadow: 0 0 15px #00e6e6; /* Glow for section titles */
        }
        body.theme-default .seva-section input, body.theme-default .seva-section select, body.theme-default .chat-section input, body.theme-default .gemini-section input, body.theme-default .leaderboard-filter-container select {
            border: 2px solid #00e6e6;
            background-color: #001a33;
            color: #00e6e6;
            box-shadow: 0 0 10px rgba(0, 230, 230, 0.5); /* Input glow */
        }
        body.theme-default .seva-section input:focus, body.theme-default .seva-section select:focus, body.theme-default .chat-section input:focus, body.theme-default .gemini-section input:focus, body.theme-default .leaderboard-filter-container select:focus {
            box-shadow: 0 0 20px #00e6e6; /* Stronger input glow on focus */
        }
        body.theme-default #submitSeva, body.theme-default .donation-section a, body.theme-default #sendMessage, body.theme-default .file-upload-container, body.theme-default .state-list button, body.theme-default #adminDashboardButton, body.theme-default #askGeminiButton, body.theme-default #settingsButtonSidebar, body.theme-default #closeSettingsSidebar {
            background-color: #00e6e6;
            color: #001a33;
            box-shadow: 0 0 35px #00e6e6; /* Stronger action button shadow */
        }
        body.theme-default #chatMessages, body.theme-default #geminiResponse {
            background-color: #001a33;
            color: #fff;
            border: 1px solid #00e6e6;
            box-shadow: inset 0 0 15px rgba(0, 230, 230, 0.3); /* Inner glow for chat messages */
        }
        body.theme-default .user-message {
            background-color: #004d99;
            box-shadow: 0 0 10px rgba(0, 77, 153, 0.5); /* User message glow */
        }
        body.theme-default .other-message {
            background-color: #007acc;
            box-shadow: 0 0 10px rgba(0, 122, 204, 0.5); /* Other message glow */
        }
        body.theme-default .group-profile-icon, body.theme-default .account-settings-icon {
            background-color: #00e6e6;
            color: #001a33;
            box-shadow: 0 0 20px #00e6e6; /* Stronger icon shadow */
        }
        body.theme-default .group-settings-dropdown, body.theme-default .account-settings-dropdown {
            background-color: #00264d;
            border: 2px solid #00e6e6;
            box-shadow: 0 0 30px #00e6e6; /* Stronger dropdown shadow */
        }
        body.theme-default .close-group-settings-button, body.theme-default #closeAccountSettings, body.theme-default #closeAdminDashboardButton {
            color: #00e6e6;
            text-shadow: 0 0 10px #00e6e6; /* Glow for close buttons */
        }
        body.theme-default .message-time {
            color: #aaa;
            text-shadow: 0 0 5px rgba(170, 170, 170, 0.3); /* Subtle glow for message time */
        }
        body.theme-default .leaderboard-section ul li {
            border-bottom: 1px solid rgba(0, 230, 230, 0.2); /* Leaderboard list item separator glow */
            padding-bottom: 8px;
            margin-bottom: 8px;
        }


        /* --- Theme: Dark A - Enhanced Glows --- */
        body.theme-dark-a {
            background-color: #121212;
            color: #e0e0e0;
        }
        body.theme-dark-a .sidebar {
            background-color: #1e1e1e;
            box-shadow: 0 0 40px #bb86fc;
        }
        body.theme-dark-a .sidebar-buttons button {
            background-color: #bb86fc;
            color: #121212;
            box-shadow: 0 0 30px #bb86fc;
        }
        body.theme-dark-a .seva-section, body.theme-dark-a .donation-section, body.theme-dark-a .leaderboard-section, body.theme-dark-a .chat-section, body.theme-dark-a .admin-dashboard-section, body.theme-dark-a .gemini-section {
            background: rgba(18, 18, 18, 0.9);
            border: 3px solid #bb86fc;
            box-shadow: 0 0 50px #bb86fc;
        }
         body.theme-dark-a .seva-section h2, body.theme-dark-a .donation-section h2, body.theme-dark-a .leaderboard-section h2, body.theme-dark-a .chat-section h2, body.theme-dark-a .admin-dashboard-section h2, body.theme-dark-a .gemini-section h2 {
            text-shadow: 0 0 15px #bb86fc;
        }
        body.theme-dark-a .seva-section input, body.theme-dark-a .seva-section select, body.theme-dark-a .chat-section input, body.theme-dark-a .gemini-section input, body.theme-dark-a .leaderboard-filter-container select {
            border: 2px solid #bb86fc;
            background-color: #1e1e1e;
            color: #e0e0e0;
            box-shadow: 0 0 10px rgba(187, 134, 252, 0.5);
        }
        body.theme-dark-a .seva-section input:focus, body.theme-dark-a .seva-section select:focus, body.theme-dark-a .chat-section input:focus, body.theme-dark-a .gemini-section input:focus, body.theme-dark-a .leaderboard-filter-container select:focus {
            box-shadow: 0 0 20px #bb86fc;
        }
        body.theme-dark-a #submitSeva, body.theme-dark-a .donation-section a, body.theme-dark-a #sendMessage, body.theme-dark-a .file-upload-container, body.theme-dark-a .state-list button, body.theme-dark-a #adminDashboardButton, body.theme-dark-a #askGeminiButton, body.theme-dark-a #settingsButtonSidebar, body.theme-dark-a #closeSettingsSidebar {
            background-color: #bb86fc;
            color: #121212;
            box-shadow: 0 0 35px #bb86fc;
        }
        body.theme-dark-a #chatMessages, body.theme-dark-a #geminiResponse {
            background-color: #1e1e1e;
            color: #e0e0e0;
            border: 1px solid #bb86fc;
            box-shadow: inset 0 0 15px rgba(187, 134, 252, 0.3);
        }
        body.theme-dark-a .user-message {
            background-color: #3700b3;
            color: #fff;
            box-shadow: 0 0 10px rgba(55, 0, 179, 0.5);
        }
        body.theme-dark-a .other-message {
            background-color: #6200ee;
            color: #fff;
            box-shadow: 0 0 10px rgba(98, 0, 238, 0.5);
        }
        body.theme-dark-a .group-profile-icon, body.theme-dark-a .account-settings-icon {
            background-color: #bb86fc;
            color: #121212;
            box-shadow: 0 0 20px #bb86fc;
        }
        body.theme-dark-a .group-settings-dropdown, body.theme-dark-a .account-settings-dropdown {
            background-color: #1e1e1e;
            border: 2px solid #bb86fc;
            box-shadow: 0 0 30px #bb86fc;
        }
        body.theme-dark-a .close-group-settings-button, body.theme-dark-a #closeAccountSettings, body.theme-dark-a #closeAdminDashboardButton {
            color: #bb86fc;
            text-shadow: 0 0 10px #bb86fc;
        }
        body.theme-dark-a .message-time {
            color: #9e9e9e;
            text-shadow: 0 0 5px rgba(158, 158, 158, 0.3);
        }
        body.theme-dark-a .leaderboard-section ul li {
            border-bottom: 1px solid rgba(187, 134, 252, 0.2);
            padding-bottom: 8px;
            margin-bottom: 8px;
        }

        /* --- Theme: White - Enhanced Glows --- */
        body.theme-white {
            background-color: #f0f0f0;
            color: #333;
        }
        body.theme-white .sidebar {
            background-color: #eee;
            box-shadow: 0 0 40px #ddd;
        }
        body.theme-white .sidebar-buttons button {
            background-color: #ddd;
            color: #333;
            box-shadow: 0 0 30px #ddd;
        }
        body.theme-white .seva-section, body.theme-white .donation-section, body.theme-white .leaderboard-section, body.theme-white .chat-section, body.theme-white .admin-dashboard-section, body.theme-white .gemini-section {
            background: rgba(240, 240, 240, 0.9);
            border: 3px solid #ddd;
            box-shadow: 0 0 50px #ddd;
        }
        body.theme-white .seva-section h2, body.theme-white .donation-section h2, body.theme-white .leaderboard-section h2, body.theme-white .chat-section h2, body.theme-white .admin-dashboard-section h2, body.theme-white .gemini-section h2 {
            text-shadow: 0 0 15px #ddd;
        }
        body.theme-white .seva-section input, body.theme-white .seva-section select, body.theme-white .chat-section input, body.theme-white .gemini-section input, body.theme-white .leaderboard-filter-container select {
            border: 2px solid #ddd;
            background-color: #fff;
            color: #333;
            box-shadow: 0 0 10px rgba(221, 221, 221, 0.5);
        }
        body.theme-white .seva-section input:focus, body.theme-white .seva-section select:focus, body.theme-white .chat-section input:focus, body.theme-white .gemini-section input:focus, body.theme-white .leaderboard-filter-container select:focus {
            box-shadow: 0 0 20px #ddd;
        }
        body.theme-white #submitSeva, body.theme-white .donation-section a, body.theme-white #sendMessage, body.theme-white .file-upload-container, body.theme-white .state-list button, body.theme-white #adminDashboardButton, body.theme-white #askGeminiButton, body.theme-white #settingsButtonSidebar, body.theme-white #closeSettingsSidebar {
            background-color: #ddd;
            color: #333;
            box-shadow: 0 0 35px #ddd;
        }
        body.theme-white #chatMessages, body.theme-white #geminiResponse {
            background-color: #fff;
            color: #333;
            border: 1px solid #ddd;
            box-shadow: inset 0 0 15px rgba(221, 221, 221, 0.3);
        }
        body.theme-white .user-message {
            background-color: #e0e0e0;
            color: #333;
            box-shadow: 0 0 10px rgba(224, 224, 224, 0.5);
        }
        body.theme-white .other-message {
            background-color: #ccc;
            color: #333;
            box-shadow: 0 0 10px rgba(204, 204, 204, 0.5);
        }
        body.theme-white .group-profile-icon, body.theme-white .account-settings-icon {
            background-color: #ddd;
            color: #333;
            box-shadow: 0 0 20px #ddd;
        }
        body.theme-white .group-settings-dropdown, body.theme-white .account-settings-dropdown {
            background-color: #eee;
            border: 2px solid #ddd;
            box-shadow: 0 0 30px #ddd;
        }
        body.theme-white .close-group-settings-button, body.theme-white #closeAccountSettings, body.theme-white #closeAdminDashboardButton {
            color: #ddd;
            text-shadow: 0 0 10px #ddd;
        }
        body.theme-white .message-time {
            color: #777;
            text-shadow: 0 0 5px rgba(119, 119, 119, 0.3);
        }
         body.theme-white .leaderboard-section ul li {
            border-bottom: 1px solid rgba(221, 221, 221, 0.2);
            padding-bottom: 8px;
            margin-bottom: 8px;
        }

        /* --- Theme: Theme 4 (Blue) - Enhanced Glows --- */
        body.theme-theme4 {
            background-color: #e3f2fd;
            color: #1a237e;
        }
        body.theme-theme4 .sidebar {
            background-color: #bbdefb;
            box-shadow: 0 0 40px #90caf9;
        }
        body.theme-theme4 .sidebar-buttons button {
            background-color: #90caf9;
            color: #1a237e;
            box-shadow: 0 0 30px #90caf9;
        }
        body.theme-theme4 .seva-section, body.theme-theme4 .donation-section, body.theme-theme4 .leaderboard-section, body.theme-theme4 .chat-section, body.theme-theme4 .admin-dashboard-section, body.theme-theme4 .gemini-section {
            background: rgba(227, 242, 253, 0.9);
            border: 3px solid #90caf9;
            box-shadow: 0 0 50px #90caf9;
        }
        body.theme-theme4 .seva-section h2, body.theme-theme4 .donation-section h2, body.theme-theme4 .leaderboard-section h2, body.theme-theme4 .chat-section h2, body.theme-theme4 .admin-dashboard-section h2, body.theme-theme4 .gemini-section h2 {
            text-shadow: 0 0 15px #90caf9;
        }
        body.theme-theme4 .seva-section input, body.theme-theme4 .seva-section select, body.theme-theme4 .chat-section input, body.theme-theme4 .gemini-section input, body.theme-theme4 .leaderboard-filter-container select {
            border: 2px solid #90caf9;
            background-color: #fff;
            color: #1a237e;
            box-shadow: 0 0 10px rgba(144, 202, 249, 0.5);
        }
        body.theme-theme4 .seva-section input:focus, body.theme-theme4 .seva-section select:focus, body.theme-theme4 .chat-section input:focus, body.theme-theme4 .gemini-section input:focus, body.theme-theme4 .leaderboard-filter-container select:focus {
            box-shadow: 0 0 20px #90caf9;
        }
        body.theme-theme4 #submitSeva, body.theme-theme4 .donation-section a, body.theme-theme4 #sendMessage, body.theme-theme4 .file-upload-container, body.theme-theme4 .state-list button, body.theme-theme4 #adminDashboardButton, body.theme-theme4 #askGeminiButton, body.theme-theme4 #settingsButtonSidebar, body.theme-theme4 #closeSettingsSidebar {
            background-color: #90caf9;
            color: #1a237e;
            box-shadow: 0 0 35px #90caf9;
        }
        body.theme-theme4 #chatMessages, body.theme-theme4 #geminiResponse {
            background-color: #fff;
            color: #1a237e;
            border: 1px solid #90caf9;
            box-shadow: inset 0 0 15px rgba(144, 202, 249, 0.3);
        }
        body.theme-theme4 .user-message {
            background-color: #90caf9;
            color: #fff;
            box-shadow: 0 0 10px rgba(144, 202, 249, 0.5);
        }
        body.theme-theme4 .other-message {
            background-color: #64b5f6;
            color: #fff;
            box-shadow: 0 0 10px rgba(100, 181, 246, 0.5);
        }
        body.theme-theme4 .group-profile-icon, body.theme-theme4 .account-settings-icon {
            background-color: #90caf9;
            color: #1a237e;
            box-shadow: 0 0 20px #90caf9;
        }
        body.theme-theme4 .group-settings-dropdown, body.theme-theme4 .account-settings-dropdown {
            background-color: #bbdefb;
            border: 2px solid #90caf9;
            box-shadow: 0 0 30px #90caf9;
        }
        body.theme-theme4 .close-group-settings-button, body.theme-theme4 #closeAccountSettings, body.theme-theme4 #closeAdminDashboardButton {
            color: #90caf9;
            text-shadow: 0 0 10px #90caf9;
        }
        body.theme-theme4 .message-time {
            color: #7986cb;
            text-shadow: 0 0 5px rgba(121, 134, 203, 0.3);
        }
        body.theme-theme4 .leaderboard-section ul li {
            border-bottom: 1px solid rgba(144, 202, 249, 0.2);
            padding-bottom: 8px;
            margin-bottom: 8px;
        }

        /* --- Theme: Theme 5 (Green) - Enhanced Glows --- */
        body.theme-theme5 {
            background-color: #f1f8e9;
            color: #1b5e20;
        }
        body.theme-theme5 .sidebar {
            background-color: #dcedc8;
            box-shadow: 0 0 40px #c5e1a5;
        }
        body.theme-theme5 .sidebar-buttons button {
            background-color: #c5e1a5;
            color: #1b5e20;
            box-shadow: 0 0 30px #c5e1a5;
        }
        body.theme-theme5 .seva-section, body.theme-theme5 .donation-section, body.theme-theme5 .leaderboard-section, body.theme-theme5 .chat-section, body.theme-theme5 .admin-dashboard-section, body.theme-theme5 .gemini-section {
            background: rgba(241, 248, 233, 0.9);
            border: 3px solid #c5e1a5;
            box-shadow: 0 0 50px #c5e1a5;
        }
        body.theme-theme5 .seva-section h2, body.theme-theme5 .donation-section h2, body.theme-theme5 .leaderboard-section h2, body.theme-theme5 .chat-section h2, body.theme-theme5 .admin-dashboard-section h2, body.theme-theme5 .gemini-section h2 {
            text-shadow: 0 0 15px #c5e1a5;
        }
        body.theme-theme5 .seva-section input, body.theme-theme5 .seva-section select, body.theme-theme5 .chat-section input, body.theme-theme5 .gemini-section input, body.theme-theme5 .leaderboard-filter-container select {
            border: 2px solid #c5e1a5;
            background-color: #fff;
            color: #1b5e20;
            box-shadow: 0 0 10px rgba(197, 225, 165, 0.5);
        }
        body.theme-theme5 .seva-section input:focus, body.theme-theme5 .seva-section select:focus, body.theme-theme5 .chat-section input:focus, body.theme-theme5 .gemini-section input:focus, body.theme-theme5 .leaderboard-filter-container select:focus {
            box-shadow: 0 0 20px #c5e1a5;
        }
        body.theme-theme5 #submitSeva, body.theme-theme5 .donation-section a, body.theme-theme5 #sendMessage, body.theme-theme5 .file-upload-container, body.theme-theme5 .state-list button, body.theme-theme5 #adminDashboardButton, body.theme-theme5 #askGeminiButton, body.theme-theme5 #settingsButtonSidebar, body.theme-theme5 #closeSettingsSidebar {
            background-color: #c5e1a5;
            color: #1b5e20;
            box-shadow: 0 0 35px #c5e1a5;
        }
        body.theme-theme5 #chatMessages, body.theme-theme5 #geminiResponse {
            background-color: #fff;
            color: #1b5e20;
            border: 1px solid #c5e1a5;
            box-shadow: inset 0 0 15px rgba(197, 225, 165, 0.3);
        }
        body.theme-theme5 .user-message {
            background-color: #c5e1a5;
            color: #fff;
            box-shadow: 0 0 10px rgba(197, 225, 165, 0.5);
        }
        body.theme-theme5 .other-message {
            background-color: #a5d6a7;
            color: #fff;
            box-shadow: 0 0 10px rgba(165, 214, 167, 0.5);
        }
        body.theme-theme5 .group-profile-icon, body.theme-theme5 .account-settings-icon {
            background-color: #c5e1a5;
            color: #1b5e20;
            box-shadow: 0 0 20px #c5e1a5;
        }
        body.theme-theme5 .group-settings-dropdown, body.theme-theme5 .account-settings-dropdown {
            background-color: #dcedc8;
            border: 2px solid #c5e1a5;
            box-shadow: 0 0 30px #c5e1a5;
        }
        body.theme-theme5 .close-group-settings-button, body.theme-theme5 #closeAccountSettings, body.theme-theme5 #closeAdminDashboardButton {
            color: #c5e1a5;
            text-shadow: 0 0 15px #c5e1a5;
        }
        body.theme-theme5 .message-time {
            color: #7cb342;
            text-shadow: 0 0 5px rgba(124, 179, 66, 0.3);
        }
        body.theme-theme5 .leaderboard-section ul li {
            border-bottom: 1px solid rgba(197, 225, 165, 0.2);
            padding-bottom: 8px;
            margin-bottom: 8px;
        }


        /* --- NEW THEME: Neon Orange --- */
        body.theme-neon-orange {
            background-color: #0a0a0a; /* Dark background for neon effect */
            color: #ffffff; /* White text for contrast */
        }
        body.theme-neon-orange .sidebar {
            background-color: #1a1a1a;
            box-shadow: 0 0 50px #ff9933; /* Neon orange sidebar shadow */
        }
        body.theme-neon-orange .sidebar-buttons button {
            background-color: #ff9933;
            color: #0a0a0a;
            box-shadow: 0 0 40px #ff9933; /* Neon orange button shadow */
            text-shadow: 0 0 10px #ff9933; /* Neon orange button text shadow */
        }
        body.theme-neon-orange .seva-section, body.theme-neon-orange .donation-section, body.theme-neon-orange .leaderboard-section, body.theme-neon-orange .chat-section, body.theme-neon-orange .admin-dashboard-section, body.theme-neon-orange .gemini-section {
            background: rgba(10, 10, 10, 0.9);
            border: 3px solid #ff9933;
            box-shadow: 0 0 60px #ff9933; /* Neon orange section shadow */
        }
        body.theme-neon-orange .seva-section h2, body.theme-neon-orange .donation-section h2, body.theme-neon-orange .leaderboard-section h2, body.theme-neon-orange .chat-section h2, body.theme-neon-orange .admin-dashboard-section h2, body.theme-neon-orange .gemini-section h2 {
            text-shadow: 0 0 20px #ff9933; /* Neon orange section title shadow */
        }
        body.theme-neon-orange .seva-section input, body.theme-neon-orange .seva-section select, body.theme-neon-orange .chat-section input, body.theme-neon-orange .gemini-section input, body.theme-neon-orange .leaderboard-filter-container select, body.theme-neon-orange .admin-dashboard-section input, body.theme-neon-orange .admin-dashboard-section select {
            border: 2px solid #ff9933;
            background-color: #1a1a1a;
            color: #ffcc66; /* Lighter orange input text */
            box-shadow: 0 0 15px #ff9933; /* Neon orange input glow */
        }
        body.theme-neon-orange .seva-section input:focus, body.theme-neon-orange .seva-section select:focus, body.theme-neon-orange .chat-section input:focus, body.theme-neon-orange .gemini-section input:focus, body.theme-neon-orange .leaderboard-filter-container select:focus, body.theme-neon-orange .admin-dashboard-section input:focus, body.theme-neon-orange .admin-dashboard-section select:focus {
            box-shadow: 0 0 30px #ff9933; /* Stronger neon orange input glow on focus */
        }
        body.theme-neon-orange #submitSeva, body.theme-neon-orange .donation-section a, body.theme-neon-orange #sendMessage, body.theme-neon-orange .file-upload-container, body.theme-neon-orange .state-list button, body.theme-neon-orange #adminDashboardButton, body.theme-neon-orange #askGeminiButton, body.theme-neon-orange #settingsButtonSidebar, body.theme-neon-orange #closeSettingsSidebar, body.theme-neon-orange .admin-action-button {
            background-color: #ff9933;
            color: #0a0a0a;
            box-shadow: 0 0 45px #ff9933; /* Neon orange action button shadow */
            text-shadow: 0 0 10px #ff9933; /* Neon orange action button text shadow */
        }
        body.theme-neon-orange #chatMessages, body.theme-neon-orange #geminiResponse, body.theme-neon-orange #adminDashboardTable {
            background-color: #1a1a1a;
            color: #ffffff;
            border: 1px solid #ff9933;
            box-shadow: inset 0 0 20px rgba(255, 153, 51, 0.4); /* Neon orange chat messages inner glow */
        }
        body.theme-neon-orange .user-message {
            background-color: #cc6600; /* Darker orange user message */
            box-shadow: 0 0 15px #ff9933; /* Neon orange user message glow */
        }
        body.theme-neon-orange .other-message {
            background-color: #ffb366; /* Lighter orange other message */
            box-shadow: 0 0 15px #ff9933; /* Neon orange other message glow */
        }
        body.theme-neon-orange .group-profile-icon, body.theme-neon-orange .account-settings-icon {
            background-color: #ff9933;
            color: #0a0a0a;
            box-shadow: 0 0 25px #ff9933; /* Neon orange icon shadow */
        }
        body.theme-neon-orange .group-settings-dropdown, body.theme-neon-orange .account-settings-dropdown {
            background-color: #1a1a1a;
            border: 2px solid #ff9933;
            box-shadow: 0 0 35px #ff9933; /* Neon orange dropdown shadow */
        }
        body.theme-neon-orange .close-group-settings-button, body.theme-neon-orange #closeAccountSettings, body.theme-neon-orange #closeAdminDashboardButton {
            color: #ff9933;
            text-shadow: 0 0 15px #ff9933; /* Neon orange close button text shadow */
        }
        body.theme-neon-orange .message-time {
            color: #ffcc99; /* Lighter orange message time */
            text-shadow: 0 0 10px rgba(255, 204, 153, 0.5); /* Neon orange message time shadow */
        }
        body.theme-neon-orange .leaderboard-section ul li {
            border-bottom: 1px solid rgba(255, 153, 51, 0.3); /* Neon orange leaderboard list item separator glow */
        }
        body.theme-neon-orange .admin-dashboard-section table th {
            border-bottom: 2px solid #ff9933; /* Neon orange header border in admin dashboard table */
        }
        body.theme-neon-orange .admin-dashboard-section table td {
            border-bottom: 1px solid rgba(255, 153, 51, 0.3); /* Neon orange row border in admin dashboard table */
        }


        /* --- NEW THEME: Neon Green --- */
        body.theme-neon-green {
            background-color: #0a0a0a; /* Dark background for neon effect */
            color: #ffffff; /* White text for contrast */
        }
        body.theme-neon-green .sidebar {
            background-color: #1a1a1a; /* Slightly darker sidebar for contrast */
            box-shadow: 0 0 50px #66ff66; /* Neon green sidebar shadow */
        }
        body.theme-neon-green .sidebar-buttons button {
            background-color: #66ff66;
            color: #0a0a0a;
            box-shadow: 0 0 40px #66ff66; /* Neon green button shadow */
            text-shadow: 0 0 10px #66ff66; /* Neon green button text shadow */
        }
        body.theme-neon-green .sidebar-buttons button:hover {
            background-color: #80ff80; /* Slightly lighter green on hover */
        }
        body.theme-neon-green .sidebar-settings-section {
            background-color: #1a1a1a; /* Match sidebar background */
        }
        body.theme-neon-green .sidebar-settings-section h3, body.theme-neon-green .sidebar-settings-section ul li, body.theme-neon-green .sidebar-settings-section #closeSettingsSidebar {
            color: #99ff99; /* Lighter green text in settings */
        }
        body.theme-neon-green .sidebar-settings-section ul li:hover {
            background-color: #336633; /* Darker green on hover in settings list */
        }
        body.theme-neon-green .sidebar-settings-section #closeSettingsSidebar:hover {
            color: #ccffcc; /* Lighter green on close button hover */
        }


        body.theme-neon-green .seva-section, body.theme-neon-green .donation-section, body.theme-neon-green .leaderboard-section, body.theme-neon-green .chat-section, body.theme-neon-green .admin-dashboard-section, body.theme-neon-green .gemini-section {
            background: rgba(10, 10, 10, 0.9);
            border: 3px solid #66ff66;
            box-shadow: 0 0 60px #66ff66; /* Neon green section shadow */
        }
        body.theme-neon-green .seva-section h2, body.theme-neon-green .donation-section h2, body.theme-neon-green .leaderboard-section h2, body.theme-neon-green .chat-section h2, body.theme-neon-green .admin-dashboard-section h2, body.theme-neon-green .gemini-section h2 {
            text-shadow: 0 0 20px #66ff66; /* Neon green section title shadow */
        }
        body.theme-neon-green .seva-section input, body.theme-neon-green .seva-section select, body.theme-neon-green .chat-section input, body.theme-neon-green .gemini-section input, body.theme-neon-green .leaderboard-filter-container select, body.theme-neon-green .admin-dashboard-section input, body.theme-neon-green .admin-dashboard-section select {
            border: 2px solid #66ff66;
            background-color: #1a1a1a;
            color: #99ff99; /* Lighter green input text */
            box-shadow: 0 0 15px #66ff66; /* Neon green input glow */
        }
        body.theme-neon-green .seva-section input:focus, body.theme-neon-green .seva-section select:focus, body.theme-neon-green .chat-section input:focus, body.theme-neon-green .gemini-section input:focus, body.theme-neon-green .leaderboard-filter-container select:focus, body.theme-neon-green .admin-dashboard-section input:focus, body.theme-neon-green .admin-dashboard-section select:focus {
            box-shadow: 0 0 30px #66ff66; /* Stronger neon green input glow on focus */
        }
        body.theme-neon-green #submitSeva, body.theme-neon-green .donation-section a, body.theme-neon-green #sendMessage, body.theme-neon-green .file-upload-container, body.theme-neon-green .state-list button, body.theme-neon-green #adminDashboardButton, body.theme-neon-green #askGeminiButton, body.theme-neon-green #settingsButtonSidebar, body.theme-neon-green #closeSettingsSidebar, body.theme-neon-green .admin-action-button {
            background-color: #66ff66;
            color: #0a0a0a;
            box-shadow: 0 0 45px #66ff66; /* Neon green action button shadow */
            text-shadow: 0 0 10px #66ff66; /* Neon green action button text shadow */
        }
        body.theme-neon-green #chatMessages, body.theme-neon-green #geminiResponse, body.theme-neon-green #adminDashboardTable {
            background-color: #1a1a1a;
            color: #ffffff;
            border: 1px solid #66ff66;
            box-shadow: inset 0 0 20px rgba(102, 255, 102, 0.4); /* Neon green chat messages inner glow */
        }
        body.theme-neon-green .user-message {
            background-color: #00cc00; /* Darker green user message */
            box-shadow: 0 0 15px #66ff66; /* Neon green user message glow */
        }
        body.theme-neon-green .other-message {
            background-color: #99ff99; /* Lighter green other message */
            box-shadow: 0 0 15px #66ff66; /* Neon green other message glow */
        }
        body.theme-neon-green .group-profile-icon, body.theme-neon-green .account-settings-icon {
            background-color: #66ff66;
            color: #0a0a0a;
            box-shadow: 0 0 25px #66ff66; /* Neon green icon shadow */
        }
        body.theme-neon-green .group-settings-dropdown, body.theme-neon-green .account-settings-dropdown {
            background-color: #1a1a1a;
            border: 2px solid #66ff66;
            box-shadow: 0 0 35px #66ff66; /* Neon green dropdown shadow */
        }
        body.theme-neon-green .close-group-settings-button, body.theme-neon-green #closeAccountSettings, body.theme-neon-green #closeAdminDashboardButton {
            color: #66ff66;
            text-shadow: 0 0 15px #66ff66; /* Neon green close button text shadow */
        }
        body.theme-neon-green .message-time {
            color: #ccffcc; /* Lighter green message time */
            text-shadow: 0 0 10px rgba(204, 255, 204, 0.5); /* Neon green message time shadow */
        }
        body.theme-neon-green .leaderboard-section ul li {
            border-bottom: 1px solid rgba(102, 255, 102, 0.3); /* Neon green leaderboard list item separator glow */
        }

        /* --- NEW THEME: White Neon Blue --- */
        body.theme-white-neon-blue {
            background-color: #f8f8ff; /* Very light background */
            color: #000080; /* Dark blue text for contrast */
        }
        body.theme-white-neon-blue .sidebar {
            background-color: #e0e0ff; /* Light sidebar background */
            box-shadow: 0 0 40px #add8e6; /* Light blue shadow */
        }
        body.theme-white-neon-blue .sidebar-buttons button {
            background-color: #add8e6; /* Light blue button */
            color: #000080;
            box-shadow: 0 0 30px #add8e6;
        }
        body.theme-white-neon-blue .seva-section, body.theme-white-neon-blue .donation-section, body.theme-white-neon-blue .leaderboard-section, body.theme-white-neon-blue .chat-section, body.theme-white-neon-blue .admin-dashboard-section, body.theme-white-neon-blue .gemini-section {
            background: rgba(248, 248, 255, 0.9);
            border: 3px solid #add8e6;
            box-shadow: 0 0 50px #add8e6;
        }
        body.theme-white-neon-blue .seva-section h2, body.theme-white-neon-blue .donation-section h2, body.theme-white-neon-blue .leaderboard-section h2, body.theme-white-neon-blue .chat-section h2, body.theme-white-neon-blue .admin-dashboard-section h2, body.theme-white-neon-blue .gemini-section h2 {
            text-shadow: 0 0 15px #add8e6;
        }
        body.theme-white-neon-blue .seva-section input, body.theme-white-neon-blue .seva-section select, body.theme-white-neon-blue .chat-section input, body.theme-white-neon-blue .gemini-section input, body.theme-white-neon-blue .leaderboard-filter-container select, body.theme-white-neon-blue .admin-dashboard-section input, body.theme-white-neon-blue .admin-dashboard-section select {
            border: 2px solid #add8e6;
            background-color: #ffffff;
            color: #000080;
            box-shadow: 0 0 10px rgba(173, 216, 230, 0.5);
        }
        body.theme-white-neon-blue .seva-section input:focus, body.theme-white-neon-blue .seva-section select:focus, body.theme-white-neon-blue .chat-section input:focus, body.theme-white-neon-blue .gemini-section input:focus, body.theme-white-neon-blue .leaderboard-filter-container select:focus, body.theme-white-neon-blue .admin-dashboard-section input:focus, body.theme-white-neon-blue .admin-dashboard-section select:focus {
            box-shadow: 0 0 20px #add8e6;
        }
        body.theme-white-neon-blue #submitSeva, body.theme-white-neon-blue .donation-section a, body.theme-white-neon-blue #sendMessage, body.theme-white-neon-blue .file-upload-container, body.theme-white-neon-blue .state-list button, body.theme-white-neon-blue #adminDashboardButton, body.theme-white-neon-blue #askGeminiButton, body.theme-white-neon-blue #settingsButtonSidebar, body.theme-white-neon-blue #closeSettingsSidebar, body.theme-white-neon-blue .admin-action-button {
            background-color: #add8e6;
            color: #000080;
            box-shadow: 0 0 35px #add8e6;
        }
        body.theme-white-neon-blue #chatMessages, body.theme-white-neon-blue #geminiResponse, body.theme-white-neon-blue #adminDashboardTable {
            background-color: #ffffff;
            color: #000080;
            border: 1px solid #add8e6;
            box-shadow: inset 0 0 15px rgba(173, 216, 230, 0.3);
        }
        body.theme-white-neon-blue .user-message {
            background-color: #b0e0e6; /* Light blue user message */
            color: #000080;
            box-shadow: 0 0 10px rgba(176, 224, 230, 0.5);
        }
        body.theme-white-neon-blue .other-message {
            background-color: #87cefa; /* Slightly darker blue other message */
            color: #000080;
            box-shadow: 0 0 10px rgba(135, 206, 250, 0.5);
        }
        body.theme-white-neon-blue .group-profile-icon, body.theme-white-neon-blue .account-settings-icon {
            background-color: #add8e6;
            color: #000080;
            box-shadow: 0 0 20px #add8e6;
        }
        body.theme-white-neon-blue .group-settings-dropdown, body.theme-white-neon-blue .account-settings-dropdown {
            background-color: #e0e0ff;
            border: 2px solid #add8e6;
            box-shadow: 0 0 30px #add8e6;
        }
        body.theme-white-neon-blue .close-group-settings-button, body.theme-white-neon-blue #closeAccountSettings, body.theme-white-neon-blue #closeAdminDashboardButton {
            color: #add8e6;
            text-shadow: 0 0 10px #add8e6;
        }
        body.theme-white-neon-blue .message-time {
            color: #87ceeb; /* Light sky blue message time */
            text-shadow: 0 0 5px rgba(135, 206, 235, 0.3);
        }
        body.theme-white-neon-blue .leaderboard-section ul li {
            border-bottom: 1px solid rgba(173, 216, 230, 0.2);
            padding-bottom: 8px;
            margin-bottom: 8px;
        }

        /* --- NEW THEME: Neon Blue --- */
        body.theme-neon-blue {
            background-color: #05051e; /* Darker background for stronger neon */
            color: #ffffff;
        }
        body.theme-neon-blue .sidebar {
            background-color: #0a0a2a; /* Darker sidebar */
            box-shadow: 0 0 50px #00bfff; /* Stronger neon blue shadow */
        }
        body.theme-neon-blue .sidebar-buttons button {
            background-color: #00bfff; /* Neon blue button */
            color: #05051e;
            box-shadow: 0 0 40px #00bfff;
            text-shadow: 0 0 10px #00bfff;
        }
        body.theme-neon-blue .seva-section, body.theme-neon-blue .donation-section, body.theme-neon-blue .leaderboard-section, body.theme-neon-blue .chat-section, body.theme-neon-blue .admin-dashboard-section, body.theme-neon-blue .gemini-section {
            background: rgba(5, 5, 30, 0.9); /* Darker section background */
            border: 3px solid #00bfff;
            box-shadow: 0 0 60px #00bfff;
        }
        body.theme-neon-blue .seva-section h2, body.theme-neon-blue .donation-section h2, body.theme-neon-blue .leaderboard-section h2, body.theme-neon-blue .chat-section h2, body.theme-neon-blue .admin-dashboard-section h2, body.theme-neon-blue .gemini-section h2 {
            text-shadow: 0 0 20px #00bfff;
        }
        body.theme-neon-blue .seva-section input, body.theme-neon-blue .seva-section select, body.theme-neon-blue .chat-section input, body.theme-neon-blue .gemini-section input, body.theme-neon-blue .leaderboard-filter-container select, body.theme-neon-blue .admin-dashboard-section input, body.theme-neon-blue .admin-dashboard-section select {
            border: 2px solid #00bfff;
            background-color: #0a0a2a; /* Darker input background */
            color: #e0ffff; /* Light cyan input text */
            box-shadow: 0 0 15px #00bfff;
        }
        body.theme-neon-blue .seva-section input:focus, body.theme-neon-blue .seva-section select:focus, body.theme-neon-blue .chat-section input:focus, body.theme-neon-blue .gemini-section input:focus, body.theme-neon-blue .leaderboard-filter-container select:focus, body.theme-neon-blue .admin-dashboard-section input:focus, body.theme-neon-blue .admin-dashboard-section select:focus {
            box-shadow: 0 0 30px #00bfff;
        }
        body.theme-neon-blue #submitSeva, body.theme-neon-blue .donation-section a, body.theme-neon-blue #sendMessage, body.theme-neon-blue .file-upload-container, body.theme-neon-blue .state-list button, body.theme-neon-blue #adminDashboardButton, body.theme-neon-blue #askGeminiButton, body.theme-neon-blue #settingsButtonSidebar, body.theme-neon-blue #closeSettingsSidebar, body.theme-neon-blue .admin-action-button {
            background-color: #00bfff; /* Neon blue action button */
            color: #05051e;
            box-shadow: 0 0 45px #00bfff;
            text-shadow: 0 0 10px #00bfff;
        }
        body.theme-neon-blue #chatMessages, body.theme-neon-blue #geminiResponse, body.theme-neon-blue #adminDashboardTable {
            background-color: #0a0a2a; /* Darker chat message background */
            color: #ffffff;
            border: 1px solid #00bfff;
            box-shadow: inset 0 0 20px rgba(0, 191, 255, 0.4);
        }
        body.theme-neon-blue .user-message {
            background-color: #008080; /* Teal user message */
            color: #ffffff;
            box-shadow: 0 0 15px #00bfff;
        }
        body.theme-neon-blue .other-message {
            background-color: #66ccff; /* Lighter blue other message */
            color: #00001e;
            box-shadow: 0 0 15px #00bfff;
        }
        body.theme-neon-blue .group-profile-icon, body.theme-neon-blue .account-settings-icon {
            background-color: #00bfff; /* Neon blue icon */
            color: #05051e;
            box-shadow: 0 0 25px #00bfff;
        }
        body.theme-neon-blue .group-settings-dropdown, body.theme-neon-blue .account-settings-dropdown {
            background-color: #0a0a2a; /* Darker dropdown background */
            border: 2px solid #00bfff;
            box-shadow: 0 0 35px #00bfff;
        }
        body.theme-neon-blue .close-group-settings-button, body.theme-neon-blue #closeAccountSettings, body.theme-neon-blue #closeAdminDashboardButton {
            color: #00bfff;
            text-shadow: 0 0 15px #00bfff;
        }
        body.theme-neon-blue .message-time {
            color: #b0e0e6; /* Light blue message time */
            text-shadow: 0 0 10px rgba(176, 224, 230, 0.5);
        }
        body.theme-neon-blue .leaderboard-section ul li {
            border-bottom: 1px solid rgba(0, 191, 255, 0.3);
        }


        /* Table styles for Kathas List */
        #chatMessages table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            color: #fff; /* Default text color, adjust based on theme */
        }

        #chatMessages th, #chatMessages td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #004080; /* Default border color, adjust based on theme */
        }

        #chatMessages th {
            border-bottom: 2px solid #00e6e6; /* Default header border color, adjust based on theme */
        }


        .sidebar {
            width: 25%;
            padding: 20px;
            box-shadow: 0 0 30px #00e6e6;
            overflow-y: auto;
            height: 100vh;
            position: sticky;
            top: 0;
            z-index: 100; /* Ensure sidebar is above content if needed */
        }

        /* ... (Sidebar Scrollbar CSS - No Changes) ... */

        .sidebar-buttons button {
            border: none;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            border-radius: 5px;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            animation: subtleGlow 2s infinite alternate;
        }

        /* ... (Sidebar Button Hover and Animation CSS - No Changes) ... */

        .content {
            width: 75%;
            display: flex;
            align-items: stretch;
            justify-content: center;
            padding: 40px;
            height: 100%;
            overflow-y: auto; /* Enable scroll for content */
        }
        /* ... (Content Scrollbar CSS - No Changes) ... */


        .seva-section, .donation-section, .leaderboard-section, .chat-section, .admin-dashboard-section, .gemini-section {
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: none;
            text-align: left;
            display: none;
            flex-direction: column;
            align-items: stretch;
            height: 100%;
            display: flex;
        }

        .chat-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .chat-header {
            display: flex;
            align-items: center;
            padding-bottom: 15px;
            border-bottom: 2px solid #00e6e6;
            margin-bottom: 15px;
            justify-content: space-between;
            position: sticky;
            top: 0;
            background: rgba(0, 26, 51, 0.9);
            z-index: 10;
            padding-top: 10px;
            padding-bottom: 10px;
            backdrop-filter: blur(15px);
        }

        /* ... (Chat Header and Icons CSS - No Changes) ... */

        .group-settings-page {
            display: none;
            flex-direction: column;
            height: 100%;
            padding: 20px;
        }

        /* ... (Group Settings Page and Dropdown CSS - No Changes) ... */

        .seva-section input, .seva-section select, .chat-section input, .admin-dashboard-section input, .admin-dashboard-section select, .gemini-section input,
        .leaderboard-filter-container select { /* ADDED leaderboard filter select style */
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px; /* Added border-radius to inputs */
            background-color: #001a33; /* Default background, adjust theme-specific if needed */
            color: #00e6e6; /* Default text color, adjust theme-specific if needed */
            border: 2px solid #00e6e6; /* Default border, adjust theme-specific if needed */
            box-shadow: 0 0 10px rgba(0, 230, 230, 0.5); /* Input glow */
            font-family: 'Poppins', sans-serif; /* Inherit font */
        }

        .seva-section input:focus, .seva-section select:focus, .chat-section input:focus, .admin-dashboard-section input:focus, .admin-dashboard-section select:focus, .gemini-section input:focus,
        .leaderboard-filter-container select:focus { /* ADDED leaderboard filter select focus style */
            box-shadow: 0 0 20px #00e6e6; /* Stronger input glow on focus */
            outline: none; /* Remove default focus outline */
        }


        #submitSeva, #adminDashboardButton, #askGeminiButton, #settingsButtonSidebar, #closeSettingsSidebar {
            padding: 12px;
            border: none;
            width: 100%;
            cursor: pointer;
            border-radius: 5px;
            animation: pulseGlow 1.5s infinite alternate;
             text-shadow: 0 0 10px #00e6e6; /* Glow for submit button text */
        }

        /* ... (Submit Button Animation CSS - No Changes) ... */

        .donation-section a {
            display: inline-block;
            padding: 12px 30px;
            border-radius: 5px;
            text-decoration: none;
             box-shadow: 0 0 35px #00e6e6; /* Donation link shadow */
        }

        #chatMessages, #geminiResponse, #adminDashboardTable {
            height: 65vh;
            min-height: 65vh;
            overflow-y: scroll;
            padding: 10px;
            margin-bottom: 10px;
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            border-radius: 10px; /* Added border-radius to chat messages box */
        }

        /* ... (Chat Messages Scrollbar CSS - No Changes) ... */


        .user-message {
            align-self: flex-start; /* Align received messages to the left */
            border-radius: 20px; /* More rounded corners for bubble effect */
            padding: 10px 15px; /* Adjusted padding */
            margin-bottom: 8px; /* Adjusted margin */
            word-wrap: break-word;
            max-width: 80%;
            position: relative;
            background-color: #004d99; /* Keep existing background */
            box-shadow: 0 0 15px rgba(0, 77, 153, 0.7); /* Stronger glow */
            color: #fff; /* Ensure text is white for contrast */
        }

        .other-message {
            align-self: flex-end; /* Align sent messages to the right */
            border-radius: 20px; /* More rounded corners for bubble effect */
            padding: 10px 15px; /* Adjusted padding */
            margin-bottom: 8px; /* Adjusted margin */
            word-wrap: break-word;
            max-width: 80%;
            position: relative;
            background-color: #007acc; /* Keep existing background */
            box-shadow: 0 0 15px rgba(0, 122, 204, 0.7); /* Stronger glow */
            color: #fff; /* Ensure text is white for contrast */
        }

        /* Message container alignment classes */
        /* ... (Message Alignment CSS - No Changes) ... */


        .message-time {
            font-size: 0.8em;
            margin-left: 5px;
            text-shadow: 0 0 5px rgba(170, 170, 170, 0.3); /* Message time shadow - redundant but ensures it */
        }

        #messageText, #geminiQuestionInput, .admin-dashboard-section input, .admin-dashboard-section select {
            width: 60%;
            margin-right: 5px;
            display: inline-block;
            border-radius: 5px; /* Added border-radius to message input */
            box-shadow: 0 0 10px rgba(0, 230, 230, 0.5); /* Message input glow */
            padding: 12px; /* Increased padding for height */
            font-size: 1em; /* Slightly larger font size */
            background-color: #001a33; /* Default background, adjust theme-specific if needed */
            color: #00e6e6; /* Default text color, adjust theme-specific if needed */
            border: 2px solid #00e6e6; /* Default border, adjust theme-specific if needed */
            font-family: 'Poppins', sans-serif; /* Inherit font */
        }
        #messageText:focus, #geminiQuestionInput:focus, .admin-dashboard-section input:focus, .admin-dashboard-section select:focus {
             box-shadow: 0 0 20px #00e6e6; /* Stronger message input glow on focus */
             outline: none; /* Remove default focus outline */
        }


        #sendMessage, #askGeminiButton {
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            display: inline-block;
            vertical-align: top;
            margin-right: 5px;
            transition: box-shadow 0.3s ease-in-out;
            animation: subtleButtonGlow 2s infinite alternate;
             text-shadow: 0 0 10px #00e6e6; /* Send button text glow */
             background-color: #00e6e6; /* Default background, adjust theme-specific if needed */
            color: #001a33; /* Default text color, adjust theme-specific if needed */
        }

        /* ... (Send Button Hover and Animation CSS - No Changes) ... */


        .file-upload-container {
            display: inline-flex;
            align-items: center;
            cursor: pointer;
            border-radius: 5px;
            padding: 8px 12px; /* Adjusted padding to match input height */
            transition: box-shadow 0.3s ease-in-out;
            animation: subtleFileGlow 2s infinite alternate;
             box-shadow: 0 0 20px #00e6e6; /* File upload container shadow */
             height: auto; /* Ensure height adjusts with padding */
             background-color: #00e6e6; /* Default background, adjust theme-specific if needed */
            color: #001a33; /* Default text color, adjust theme-specific if needed */
        }

        /* ... (File Upload Container Hover and Animation CSS - No Changes) ... */


        .file-upload-icon {
            font-size: 1.2em;
            margin-right: 5px;
             text-shadow: 0 0 10px #00e6e6; /* File upload icon glow */
        }

        #fileInput {
            display: none;
        }


        .delete-button, .admin-delete-button {
            position: absolute;
            top: 5px;
            right: 5px;
            background: none;
            border: none;
            color: red;
            cursor: pointer;
            font-size: 0.8em;
            padding: 0;
            margin: 0;
             text-shadow: 0 0 5px red; /* Glow for delete buttons */
        }
        /* ... (Admin Delete Button CSS - No Changes) ... */

        .leaderboard-section ul {
            list-style: none; /* Remove default list bullets */
            padding-left: 0; /* Remove default padding */
        }
         .leaderboard-section h2 {
            margin-bottom: 20px; /* Add space below leaderboard title */
             text-shadow: 0 0 15px #00e6e6; /* Leaderboard title glow - redundant but ensures it */
        }
        /* Leaderboard table styles */
        .leaderboard-section table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            color: #fff; /* Default text color, adjust based on theme */
        }

        .leaderboard-section th, .leaderboard-section td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid rgba(0, 230, 230, 0.2); /* Row separator color */
        }

        .leaderboard-section th {
            border-bottom: 2px solid #00e6e6; /* Header border color */
        }

         .leaderboard-section button {
            background-color: #00e6e6;
            color: #001a33;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        /* ... (Leaderboard Button Hover CSS - No Changes) ... */
    </style>
    <style>
        .state-list button {
            display: block;
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: none;
            border-radius: 5px;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, background-color 0.3s ease; /* Added background-color transition */
            font-weight: bold;
            text-align: left;
            cursor: pointer;
            animation: subtleStateButtonGlow 2s infinite alternate;
             box-shadow: 0 0 20px #00e6e6; /* State button shadow */
            position: relative; /* For unread badge positioning */
             background-color: #00e6e6; /* Default background, adjust theme-specific if needed */
            color: #001a33; /* Default text color, adjust theme-specific if needed */
        }

        /* ... (State Button Hover, Animation, Unread Indicator CSS - No Changes) ... */


    </style>
    <style>
        /* Sidebar Settings Section Styles */
        .sidebar-settings-section {
            display: none; /* Initially hidden */
            padding: 20px;
        }

        .sidebar-settings-section h3 {
            margin-top: 0;
            margin-bottom: 15px;
            text-align: center;
        }

        .sidebar-settings-section ul {
            list-style: none;
            padding: 0;
        }

        .sidebar-settings-section li {
            padding: 10px 0;
            border-bottom: 1px solid rgba(0, 230, 230, 0.2);
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .sidebar-settings-section li:last-child {
            border-bottom: none;
        }

        .sidebar-settings-section li:hover {
            background-color: #004080; /* Example hover color */
        }

        .sidebar-settings-section #closeSettingsSidebar {
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            display: block;
            margin: 15px auto 0; /* Center close button */
            padding: 10px 20px;
            border-radius: 5px;
            transition: color 0.2s ease;
        }

        .sidebar-settings-section ul li ul {
            list-style: none;
            padding-left: 20px; /* Indent theme options */
            margin-top: 5px;
        }

        .sidebar-settings-section ul li ul li {
            padding: 8px 0;
            cursor: pointer;
        }
        .sidebar-settings-section ul li ul li:hover {
            background-color: #004080;
        }
    </style>
    <style>
        /* Message Avatar Styles */
        .message-container {
            display: flex; /* Use flexbox for avatar and message content */
            margin-bottom: 10px;
            padding-bottom: 5px; /* Add some padding below each message */
            border-bottom: 1px solid rgba(0, 230, 230, 0.1); /* Subtle glowing divider */
        }

        .message-container:last-child { /* Remove border for the last message to avoid extra line at the bottom */
            border-bottom: none;
        }

        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: #00e6e6; /* Avatar background color */
            color: #001a33; /* Avatar text color */
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 10px; /* Spacing between avatar and text */
            font-weight: bold;
            font-size: 0.9em;
            overflow: hidden; /* Ensure initials stay within circle */
            box-shadow: 0 0 10px #00e6e6; /* Avatar shadow */
        }

        .message-text-content {
            flex-grow: 1; /* Allow message content to take remaining space */
        }

        .user-message { /* User message styles remain same, just apply to message-text-content now */
            align-self: flex-start;
            border-radius: 20px;
            padding: 10px 15px;
            margin-bottom: 8px;
            word-wrap: break-word;
            max-width: 80%;
            position: relative;
            box-shadow: 0 0 15px rgba(0, 77, 153, 0.7);
            color: #fff;
        }

        .other-message { /* Other message styles remain same, apply to message-text-content */
            align-self: flex-end;
            border-radius: 20px;
            padding: 10px 15px;
            margin-bottom: 8px;
            word-wrap: break-word;
            max-width: 80%;
            position: relative;
            box-shadow: 0 0 15px rgba(0, 122, 204, 0.7);
            color: #fff;
        }
    </style>
    <style>
        /* Leaderboard Filter Styles */
        .leaderboard-filter-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }

        .leaderboard-filter-container label {
            font-weight: bold;
        }
    </style>
    <style>
        /* Admin Dashboard Styles */
        #adminDashboardSection table th {
            background-color: #ff7700; /* Slightly darker orange header */
            color: #0a0a0a;
        }

        #adminDashboardSection table td {
            background-color: #1a1a1a; /* Match input background */
        }

        .admin-action-button {
            padding: 8px 12px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            margin: 5px;
            transition: background-color 0.3s ease;
        }

        .approve-button {
            background-color: #4CAF50; /* Green for approve */
            color: white;
        }

        .reject-button {
            background-color: #F44336; /* Red for reject */
            color: white;
        }

        .admin-action-button:hover {
            opacity: 0.8;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body class="theme-neon-green"> <!-- Default theme is now neon-green -->
    <div class="sidebar">
        <h2>🌍 Seva Application 🌍</h2>

        <div class="sidebar-buttons" id="sidebarButtons">
            <button onclick="showSection('sevaForm')">🔥 Apply for Seva 🔥</button>
            <button onclick="showSection('donationSection')">💰 Donate Now 💰</button>
            <button id="showLeaderboard" onclick="showSection('leaderboardSection')">🏆 Leaderboard 🏆</button>
            <button onclick="openChatroom('Kathas List')">📜 Kathas List 📜</button>  <!-- Renamed to Kathas List -->
            <button onclick="openChatroom('General Group')">👥 General Group Chat 👥</button>
            <!-- Volunteers Group Chat REMOVED -->
            <button onclick="showGeminiSection()">🤖 Gemini AI Chat 🤖</button>  <!-- NEW GEMINI AI BUTTON -->
            <button id="adminDashboardButton" onclick="toggleAdminDashboard()">⚙️ Admin Dashboard ⚙️</button>
            <button id="settingsButtonSidebar" onclick="showSettingsSection()">⚙️ Settings ⚙️</button> <!-- New Settings Button in Sidebar -->
        </div>

        <div class="sidebar-settings-section" id="settingsSidebarSection" style="display: none;">
            <h3>⚙️ Settings ⚙️</h3>
            <ul>
                <li onclick="alert('View Account Details (Not Implemented)');">Account Details</li>
                <li>
                    Theme
                    <ul>
                        <li class="theme-option-sidebar" data-theme="default">Default</li>
                        <li class="theme-option-sidebar" data-theme="dark-a">Dark A</li>
                        <li class="theme-option-sidebar" data-theme="white">White</li>
                        <li class="theme-option-sidebar" data-theme="theme4">Blue</li>
                        <li class="theme-option-sidebar" data-theme="theme5">Green</li>
                        <li class="theme-option-sidebar" data-theme="neon-orange">Neon Orange</li>
                        <li class="theme-option-sidebar" data-theme="neon-green">Neon Green</li>
                        <li class="theme-option-sidebar" data-theme="white-neon-blue">White Neon Blue</li>  <!-- NEW THEME OPTION -->
                        <li class="theme-option-sidebar" data-theme="neon-blue">Neon Blue</li>         <!-- NEW THEME OPTION -->
                    </ul>
                </li>
                <li onclick="alert('Notification Settings (Not Implemented)');">Notifications</li>
            </ul>
            <button id="closeSettingsSidebar">❌ Close Settings</button>
        </div>


        <h3 style="margin-top: 20px;">📌 State Chatrooms</h3>
        <div class="state-list">
            <button onclick="openChatroom('Andhra Pradesh')"><i class="fas fa-map-marker-alt"></i> Andhra Pradesh</button>
            <button onclick="openChatroom('Arunachal Pradesh')"><i class="fas fa-map-marker-alt"></i> Arunachal Pradesh</button>
            <button onclick="openChatroom('Assam')"><i class="fas fa-map-marker-alt"></i> Assam</button>
            <button onclick="openChatroom('Bihar')"><i class="fas fa-map-marker-alt"></i> Bihar</button>
            <button onclick="openChatroom('Chhattisgarh')"><i class="fas fa-map-marker-alt"></i> Chhattisgarh</button>
            <button onclick="openChatroom('Goa')"><i class="fas fa-map-marker-alt"></i> Goa</button>
            <button onclick="openChatroom('Gujarat')"><i class="fas fa-map-marker-alt"></i> Gujarat</button>
            <button onclick="openChatroom('Haryana')"><i class="fas fa-map-marker-alt"></i> Haryana</button>
            <button onclick="openChatroom('Himachal Pradesh')"><i class="fas fa-map-marker-alt"></i> Himachal Pradesh</button>
            <button onclick="openChatroom('Jharkhand')"><i class="fas fa-map-marker-alt"></i> Jharkhand</button>
            <button onclick="openChatroom('Karnataka')"><i class="fas fa-map-marker-alt"></i> Karnataka</button>
            <button onclick="openChatroom('Kerala')"><i class="fas fa-map-marker-alt"></i> Kerala</button>
            <button onclick="openChatroom('Madhya Pradesh')"><i class="fas fa-map-marker-alt"></i> Madhya Pradesh</button>
            <button onclick="openChatroom('Maharashtra')"><i class="fas fa-map-marker-alt"></i> Maharashtra</button>
            <button onclick="openChatroom('Manipur')"><i class="fas fa-map-marker-alt"></i> Manipur</button>
            <button onclick="openChatroom('Meghalaya')"><i class="fas fa-map-marker-alt"></i> Meghalaya</button>
            <button onclick="openChatroom('Mizoram')"><i class="fas fa-map-marker-alt"></i> Mizoram</button>
            <button onclick="openChatroom('Nagaland')"><i class="fas fa-map-marker-alt"></i> Nagaland</button>
            <button onclick="openChatroom('Odisha')"><i class="fas fa-map-marker-alt"></i> Odisha</button>
            <button onclick="openChatroom('Punjab')"><i class="fas fa-map-marker-alt"></i> Punjab</button>
            <button onclick="openChatroom('Rajasthan')"><i class="fas fa-map-marker-alt"></i> Rajasthan</button>
            <button onclick="openChatroom('Sikkim')"><i class="fas fa-map-marker-alt"></i> Sikkim</button>
            <button onclick="openChatroom('Tamil Nadu')"><i class="fas fa-map-marker-alt"></i> Tamil Nadu</button>
            <button onclick="openChatroom('Telangana')"><i class="fas fa-map-marker-alt"></i> Telangana</button>
            <button onclick="openChatroom('Tripura')"><i class="fas fa-map-marker-alt"></i> Tripura</button>
            <button onclick="openChatroom('Uttar Pradesh')"><i class="fas fa-map-marker-alt"></i> Uttar Pradesh</button>
            <button onclick="openChatroom('Uttarakhand')"><i class="fas fa-map-marker-alt"></i> Uttarakhand</button>
            <button onclick="openChatroom('West Bengal')"><i class="fas fa-map-marker-alt"></i> West Bengal</button>
        </div>
    </div>

    <div class="content">
        <div id="sevaForm" class="seva-section">
            <h2>Apply for Seva</h2>
            <input type="text" id="name" placeholder="Enter your name">
            <input type="text" id="phone" placeholder="Enter your phone number">
            <input type="email" id="email" placeholder="Enter your email">
            <select id="sevaType">
                <option value="">Select Seva Type</option>
                <option value="Teaching">Teaching</option>
                <option value="Cleaning">Cleaning</option>
                <option value="Food Distribution">Food Distribution</option>
            </select>
            <!-- New District Selection Dropdown -->
            <select id="district" style="display:none;">
                <option value="">Select District</option>
                <!-- Districts will be populated dynamically here -->
            </select>
            <!-- New State Selection Dropdown -->
            <select id="state">
                <option value="">Select State</option>
                <option value="Andhra Pradesh">Andhra Pradesh</option>
                <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                <option value="Assam">Assam</option>
                <option value="Bihar">Bihar</option>
                <option value="Chhattisgarh">Chhattisgarh</option>
                <option value="Goa">Goa</option>
                <option value="Gujarat">Gujarat</option>
                <option value="Haryana">Haryana</option>
                <option value="Himachal Pradesh">Himachal Pradesh</option>
                <option value="Jharkhand">Jharkhand</option>
                <option value="Karnataka">Karnataka</option>
                <option value="Kerala">Kerala</option>
                <option value="Madhya Pradesh">Madhya Pradesh</option>
                <option value="Maharashtra">Maharashtra</option>
                <option value="Manipur">Manipur</option>
                <option value="Meghalaya">Meghalaya</option>
                <option value="Mizoram">Mizoram</option>
                <option value="Nagaland">Nagaland</option>
                <option value="Odisha">Odisha</button>
                <option value="Punjab">Punjab</option>
                <option value="Rajasthan">Rajasthan</option>
                <option value="Sikkim">Sikkim</button>
                <option value="Tamil Nadu">Tamil Nadu</button>
                <option value="Telangana">Telangana</button>
                <option value="Tripura">Tripura</option>
                <option value="Uttar Pradesh">Uttar Pradesh</option>
                <option value="Uttarakhand">Uttarakhand</option>
                <option value="West Bengal">West Bengal</option>
            </select>
            <input type="date" id="sevaStartDate" placeholder="Seva Start Date"> <br><br> <!-- Seva Start Date Input -->
            <input type="date" id="sevaEndDate" placeholder="Seva End Date">   <br><br> <!-- Seva End Date Input -->
            <button id="submitSeva">Submit Seva Application</button>
        </div>

        <div id="donationSection" class="donation-section">
            <h2>Donate Now</h2>
            <p>Your generous donations help us to expand our Seva initiatives and reach more people in need.  Every contribution, big or small, makes a significant difference in supporting our mission to serve the community. Your support enables us to provide essential resources, organize impactful seva activities, and ensure the sustainability of our programs. Thank you for considering donating and being a part of this noble cause. Together, we can create a positive impact and make a difference in the lives of many.</p>
            <a href="https://buy.stripe.com/test_cN214T3BR4Ga0Lu288" target="_blank">Donate via Stripe</a>
        </div>

        <div id="leaderboardSection" class="leaderboard-section">
            <h2>Leaderboard</h2>
            <div class="leaderboard-filter-container">
                <label for="leaderboardStateFilter">Filter by State:</label>
                <select id="leaderboardStateFilter">
                    <option value="All States">All States</option>
                    <option value="Andhra Pradesh">Andhra Pradesh</option>
                    <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                    <option value="Assam">Assam</option>
                    <option value="Bihar">Bihar</option>
                    <option value="Chhattisgarh">Chhattisgarh</option>
                    <option value="Goa">Goa</option>
                    <option value="Gujarat">Gujarat</option>
                    <option value="Haryana">Haryana</option>
                    <option value="Himachal Pradesh">Himachal Pradesh</option>
                    <option value="Jharkhand">Jharkhand</option>
                    <option value="Karnataka">Karnataka</option>
                    <option value="Kerala">Kerala</option>
                    <option value="Madhya Pradesh">Madhya Pradesh</option>
                    <option value="Maharashtra">Maharashtra</option>
                    <option value="Manipur">Manipur</option>
                    <option value="Meghalaya">Meghalaya</option>
                    <option value="Mizoram">Mizoram</option>
                    <option value="Nagaland">Nagaland</option>
                    <option value="Odisha">Odisha</option>
                    <option value="Punjab">Punjab</option>
                    <option value="Rajasthan">Rajasthan</option>
                    <option value="Sikkim">Sikkim</button>
                    <option value="Tamil Nadu">Tamil Nadu</option>
                    <option value="Telangana">Telangana</button>
                    <option value="Tripura">Tripura</option>
                    <option value="Uttar Pradesh">Uttar Pradesh</option>
                    <option value="Uttarakhand">Uttarakhand</option>
                    <option value="West Bengal">West Bengal</option>
                </select>

                <label for="leaderboardDistrictFilter">Filter by District:</label>
                <select id="leaderboardDistrictFilter" style="display:none;">
                    <option value="All Districts">All Districts</option>
                    <!-- Districts will be populated dynamically here -->
                </select>
            </div>
            <div id="leaderboardTable"></div>
        </div>

        <div id="chatSection" class="chat-section" style="display: flex; flex-direction: column;">
            <div class="chat-header">
                <h2 id="currentChatStateName">Chat Room</h2>
                <div class="chat-header-icons">
                    <div class="account-settings-icon" id="accountSettingsIcon">
                        <i class="fas fa-cog"></i>
                        <div class="account-settings-dropdown" id="accountSettingsDropdown">
                            <ul>
                                <li onclick="alert('View Account Details (Not Implemented)');">Account Details</li>
                                <li>
                                    Theme
                                    <ul>
                                        <li class="theme-option" data-theme="default">Default</li>
                                        <li class="theme-option" data-theme="dark-a">Dark A</li>
                                        <li class="theme-option" data-theme="white">White</li>
                                        <li class="theme-option" data-theme="theme4">Blue</li>
                                        <li class="theme-option" data-theme="theme5">Green</li>
                                        <li class="theme-option" data-theme="neon-orange">Neon Orange</li>
                                        <li class="theme-option" data-theme="neon-green">Neon Green</li>
                                        <li class="theme-option" data-theme="white-neon-blue">White Neon Blue</li>  <!-- NEW THEME OPTION -->
                                        <li class="theme-option" data-theme="neon-blue">Neon Blue</li>         <!-- NEW THEME OPTION -->
                                    </ul>
                                </li>
                                <li onclick="alert('Notification Settings (Not Implemented)');">Notifications</li>
                                <li id="closeAccountSettings">Close Settings</li>
                                <!-- Add more account settings options here -->
                            </ul>
                        </div>
                    </div>
                    <div class="group-profile-icon" id="groupProfileIcon">
                        <span>GR</span>
                    </div>
                </div>
            </div>

            <div id="chatMessageContainer" class="chat-area" style="display: flex; flex-direction: column;">
                <div id="chatMessages">
                    <!-- Messages will be loaded here -->
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <input type="text" id="messageText" placeholder="Type your message here">
                    <button id="sendMessage">Send</button>
                    <button id="addContactButton">Add Contact</button>  <!-- "Add Contact" Button -->
                    <div class="file-upload-container" id="fileInput-trigger">
                        <i class="fas fa-upload file-upload-icon"></i> <span>Choose Files</span>
                    </div>
                    <input type="file" id="fileInput" style="color: #00e6e6;">
                </div>
            </div>

            <div id="groupSettingsPage" class="group-settings-page" style="display: none;">
                <div class="group-settings-header">
                    <h3>Group Settings</h3>
                    <button id="closeGroupSettingsButton" class="close-group-settings-button">
                        <i class="fas fa-times-circle"></i>
                    </button>
                </div>

                <div class="group-settings-dropdown">
                    <h4>Group Members</h4>
                    <ul id="groupMembersList">
                        <!-- Group members will be listed here -->
                    </ul>
                </div>

                <ul class="group-settings-options">
                    <li onclick="alert('Group Settings Option 1 (Not Implemented)');">Option 1</li>
                    <li onclick="alert('Group Settings Option 2 (Not Implemented)');">Option 2</li>
                    <li onclick="alert('Group Settings Option 3 (Not Implemented)');">Option 3</li>
                    <!-- Add more group settings options here -->
                </ul>
            </div>
        </div>

        <!-- Admin Dashboard Section -->
        <div id="adminDashboardSection" class="admin-dashboard-section" style="display: none;">
            <div class="chat-header" style="border-bottom: 2px solid #ff9933;">
                <h2 style="text-shadow: 0 0 15px #ff9933;">Admin Dashboard</h2>
                <div class="chat-header-icons">
                    <button id="closeAdminDashboardButton" class="close-group-settings-button" onclick="hideAdminDashboard()">
                        <i class="fas fa-times-circle"></i>
                    </button>
                </div>
            </div>
            <div style="padding: 20px;">
                <h3>Seva Application Management</h3>
                <div id="adminDashboardTable">
                    <!-- Admin dashboard table will be loaded here -->
                </div>

                <h3 style="margin-top: 20px;">12-Month Team Schedule</h3>
                <div id="monthlyScheduleDisplay">
                    <!-- Monthly schedule table will be loaded here -->
                </div>

                <!-- Future admin functionalities can be added here -->
            </div>
        </div>

        <!-- Gemini AI Chat Section -->
        <div id="geminiSection" class="gemini-section" style="display: none;">
            <div class="chat-header">
                <h2>Gemini AI Chat</h2>
                <div class="chat-header-icons">
                    <button id="closeGeminiSectionButton" class="close-group-settings-button" onclick="hideGeminiSection()">
                        <i class="fas fa-times-circle"></i>
                    </button>
                </div>
            </div>
            <div style="padding: 20px;">
                <input type="text" id="geminiQuestionInput" placeholder="Ask me anything...">
                <button id="askGeminiButton">Ask Gemini AI</button>
                <div id="geminiResponse" style="margin-top: 20px; padding: 10px; border: 1px solid #00e6e6; border-radius: 5px;">
                    <!-- Gemini AI response will be displayed here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ---  Conditionally Show Admin Dashboard Button ---
        document.addEventListener("DOMContentLoaded", function () {
            if (isAdminUser(currentSenderName)) {
                document.getElementById('adminDashboardButton').style.display = 'block'; // Show button for admins
            }
        });
        </script>
        <script>

        </script>
        <script>
            async function sendMessageToDialogflow() {
                const userMessage = document.getElementById("userMessage").value;
                if (!userMessage) return;

                try {
                    const response = await fetch("/sendMessage", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ message: userMessage })
                    });

                    const responseData = await response.json();
                    displayMessage("You", userMessage);
                    displayMessage("Bot", responseData.reply);

                    document.getElementById("userMessage").value = ""; // Clear input
                } catch (error) {
                    console.error("Error:", error);
                    displayMessage("Bot", "Error connecting to Dialogflow.");
                }
            }

            function displayMessage(sender, message) {
                const chatBox = document.getElementById("chatBox");
                const messageElement = document.createElement("p");
                messageElement.innerHTML = `<strong>${sender}:</strong> ${message}`;
                chatBox.appendChild(messageElement);
                chatBox.scrollTop = chatBox.scrollHeight;
            }
        </script>



    </script>
</body>


</body>
</html>
